# 22.5 Java 环境的配置

FreeBSD 支持 Oracle JDK 与 OpenJDK。Oracle JDK 并非原生支持，需要使用 Linux 二进制兼容层。参见 [https://www.freebsd.org/java/](https://www.freebsd.org/java/)。

## JDK

### OracleJDK

待测试。

### OpenJDK

搜索名称或描述中包含“jdk”的软件包：

```sh
# pkg search -o jdk
java/bootstrap-openjdk11       Java Development Kit 11
java/bootstrap-openjdk17       Java Development Kit 17
java/bootstrap-openjdk8        Java Development Kit 8
java/openjdk11                 Java Development Kit 11
java/openjdk11-jre             Java Runtime Environment 11
java/openjdk17                 Java Development Kit 17
java/openjdk17-jre             Java Runtime Environment 17
java/openjdk18                 Java Development Kit 18
java/openjdk19                 Java Development Kit 19
java/openjdk20                 Java Development Kit 20
java/openjdk21                 Java Development Kit 21
java/openjdk22                 Java Development Kit 22
java/openjdk23                 Java Development Kit 23
java/openjdk8                  Java Development Kit 8
java/openjdk8-jre              Java Runtime Environment 8
comms/rxtx                     Native interface to serial ports in Java
```

本文将以 `java/openjdk23` 为例。

### 安装 OpenJDK 23

使用 pkg 安装 OpenJDK 23：

```sh
# pkg ins openjdk23
```

或者使用 ports 安装：

```sh
# cd /usr/ports/java/openjdk23
# make install clean
```

显示已安装 Java 的版本信息：

```sh
# java -version
openjdk version "23.0.2" 2025-01-21
OpenJDK Runtime Environment (build 23.0.2+7-1)
OpenJDK 64-Bit Server VM (build 23.0.2+7-1, mixed mode, sharing)
```

安装完成后尚未配置 `$JAVA_HOME` 环境变量，可使用以下命令查看其当前值：

```sh
# echo $JAVA_HOME

```

查看 openjdk23 安装路径：

```sh
# ls /usr/local/openjdk23/
/usr/local/openjdk23/bin/     /usr/local/openjdk23/include/ /usr/local/openjdk23/lib/
/usr/local/openjdk23/conf/    /usr/local/openjdk23/jmods/   /usr/local/openjdk23/man/
/usr/local/openjdk23/demo/    /usr/local/openjdk23/legal/   /usr/local/openjdk23/release
```


### 配置环境变量

请读者根据自己的 Shell，选择合适的路径。

- `~/.bashrc`（bash）
- `~/.profile`（通用）
- `~/.shrc`（FreeBSD 默认的 sh）
- `~/.zshrc`（zsh）

将以下内容写入：

```ini
export JAVA_HOME="/usr/local/openjdk23"          # 设置 JAVA_HOME 环境变量指向 OpenJDK 23 安装路径
export PATH=$JAVA_HOME/bin:$PATH                # 将 JAVA_HOME/bin 添加到 PATH，确保 java 命令可用
```


刷新 shell 环境变量：

```sh
# . ~/.shrc # 重新加载 ~/.shrc 配置文件（注意前面的点表示 source）
# echo $JAVA_HOME	# 显示当前 JAVA_HOME 环境变量值
/usr/local/openjdk23
# echo $PATH	# 显示当前 PATH 环境变量值，包含 JAVA_HOME/bin
/usr/local/openjdk23/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:/root/bin
```

## Eclipse

### 安装 eclipse

使用 pkg 安装：

```sh
# pkg ins eclipse
```

或者使用 ports 安装：

```sh
# cd /usr/ports/java/eclipse
# make install clean
```

### 设置中文

点击菜单 `Help`，然后选择 `Install New Software`。


![](../.gitbook/assets/eclipse1.png)

取消勾选 `Contact all update sites during install to find required software`，然后点击 `Add`：

![](../.gitbook/assets/eclipse2.png)

清除 `Location` 原有内容，加入 `https://mirrors.tuna.tsinghua.edu.cn/eclipse/technology/babel/update-site/latest/`。再点击 `Add`：


![](../.gitbook/assets/eclipse3.png)

加载中：

![](../.gitbook/assets/eclipse4.png)

勾选 `Babel Language Packs in Chinese (Simplified)`。点击 `Next`。

![](../.gitbook/assets/eclipse5.png)


点击 `Next`。

![](../.gitbook/assets/eclipse6.png)

同意协议：

![](../.gitbook/assets/eclipse7.png)

建议先点击界面底部的任意位置，然后再进行全选，否则可能导致界面卡顿。

![](../.gitbook/assets/eclipse8.png)

重启即可：

![](../.gitbook/assets/eclipse9.png)

![](../.gitbook/assets/eclipse10.png)

#### 参考文献

- [Eclipse 2024.03 安装教程（附中文语言设置教程）](https://www.ittel.cn/archives/35394.html)

### HelloWorld

点击 `创建 Java 项目`，项目名 `test`。

![](../.gitbook/assets/eclipse11.png)

右键创建一个 `包`，再创建一个 `java 类`，名称 `test`。

![](../.gitbook/assets/eclipse12.png)

在类文件中写入以下代码内容：

```java
package test;

public class HelloWorld {
	  public static void main(String[] args) {
		    System.out.println("Hello World!");
		  }
}
```

点击绿色三角，即可看到输出

![](../.gitbook/assets/eclipse13.png)



#### 参考文献

- [Eclipse 使用配置全面讲解](https://www.cnblogs.com/xxhxs-21/articles/16417603.html)

## IntelliJ IDEA

### 安装 IntelliJ IDEA Ultimate

使用 pkg 安装：

```sh
# pkg ins intellij-ultimate
```

或者使用 ports 安装：

```sh
# cd /usr/ports/java/intellij-ultimate
# make install clean
```

### 查看安装后说明


```sh
# pkg info -D intellij-ultimate
intellij-ultimate-2024.3.1.1:
On install:
There is a native (faster) file watching support backed by kqueue which is
enabled by default.  If you encounter problems with watching large
trees, you can disable it by adding the following property via the menu
entry Help -> Edit Custom Properties...

      idea.filewatcher.disabled=true
有一个由 kqueue 支持的本地（更快的）文件监视功能，默认启用。如果你在监视大的文件树时遇到问题，可以通过菜单项 Help -> Edit Custom Properties... 添加以下属性来禁用它：

      idea.filewatcher.disabled=true
```

---

系统默认启用了基于 kqueue 的内置（更快的）文件监视支持。若你监视大型目录结构时出现了问题，可以通过菜单路径 `Help`（帮助） -> `Edit Custom Properties...`（编辑自定义属性……）添加以下属性来禁用该功能：

```ini
  idea.filewatcher.disabled=true
```

## 使用

在 FreeBSD 下使用时可能会出现报错“编辑器中的文件不可运行”，而 Windows 版本则正常。该问题已报告为 [Bug 285130 - Port java/intellij-ultimate always shows This file in the editor is not runnable](https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=285130)。

IntelliJ IDEA 社区版可以正常使用，但长期未更新，最新版本仍为 2020.2。

### 故障排除与未竟事宜

#### 提示“the file in the editor is not runnable”

该问题仍待解决。
