# 22.16 FreeBSD 内核配置选项

## 内核配置选项路径

- amd64 内核配置选项位于 [freebsd-src/main/sys/amd64/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/amd64/conf)。
- Arm64 内核配置选项位于 [freebsd-src/main/sys/arm64/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/arm64/conf)。
- RISC-V 内核配置选项位于 [freebsd-src/main/sys/riscv/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/riscv/conf)

## amd64 内核配置文件

介绍  [freebsd-src/main/sys/amd64/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/amd64/conf)：

- `DEFAULTS`：FreeBSD/amd64 的默认内核配置文件，只有不到 30 行
- `FIRECRACKER`：面向 [Firecracker](https://firecracker-microvm.github.io/) VM 的内核配置文件，参见 [amd64: Add FIRECRACKER kernel configuration](https://reviews.freebsd.org/D36672)
- `GENERIC`：FreeBSD/amd64 通用内核配置文件，所有 amd64 镜像默认基于此。350 余行。
- `GENERIC-KASAN`：调试开发用。参见 [amd64: Add MD bits for KASAN](https://reviews.freebsd.org/D29455)。用于 KASAN（Kernel Address SANitizer，内核地址清理器），参见 [kasan(9)](https://man.freebsd.org/cgi/man.cgi?query=kasan&sektion=9&format=html)，只有不到十行
- `GENERIC-KCSAN`：调试开发用。KCSAN（Kernel Concurrency Sanitizer，内核并发清理器）。30 余行，参见 [Port the NetBSD KCSAN runtime to FreeBSD](https://reviews.freebsd.org/D22315)
- `GENERIC-KMSAN`：调试开发用。不到十行。KMSAN（Kernel Memory SANitizer，内核内存清理器）参见 [KMSAN(9)](https://man.freebsd.org/cgi/man.cgi?query=kmsan&sektion=9&format=html)
- `GENERIC-MMCCAM`：调试开发用。使用 MMCCAM 代替 MMC 栈。不到二十行。参见 [MMC stack on top of CAM framework](https://reviews.freebsd.org/D4761)。
- `GENERIC-NODEBUG`：[CURRENT 系统会启用](https://github.com/freebsd/freebsd-src/blob/main/UPDATING)，用于调试开发。三十余行。基于 GENERIC 配置文件，但是删掉了 [WITNESS (4)](https://man.freebsd.org/cgi/man.cgi?witness(4))（跟踪每个线程获取和释放的锁）和 [INVARIANTS (9)](https://man.freebsd.org/cgi/man.cgi?KASSERT(9))（内核表达式验证宏）。
- `GENERIC.hints`：一些 [hints](https://man.freebsd.org/device.hints) 参数。二十余行。用于设置驱动的参数。
- `LINT`：LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)，用于验证代码风格格式等。不到五行。
- `LINT-NOINET`：LINT 文件，不到五行，禁用了 [INET(4)](https://man.freebsd.org/cgi/man.cgi?query=inet&sektion=4&man)（IPv4）。LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)。
- `LINT-NOINET6`：LINT 文件，不到五行，禁用了 [INET(6)](https://man.freebsd.org/cgi/man.cgi?query=inet6&sektion=4&man)（IPv6）。LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)。
- `LINT-NOIP`：LINT 文件，不到三十行，禁用了 IP 协议相关（IPv4、IPv6、TLS 等）。LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)。
- `LINT-NOVIMAGE`：调试开发用。LINT 文件，不到五行，禁用了 [VIMAGE (9)](https://man.freebsd.org/cgi/man.cgi?query=vimage&sektion=9)（实际上是 VNET(9) 的别名，网络子系统虚拟化基础设施）。参见 [sys: add LINT-NOVIMAGE](https://reviews.freebsd.org/D50780)
- `MINIMAL`：FreeBSD/amd64 中最常用的最简内核配置选项。160 余行。
- `MINIMAL-NODEBUG`：等同于 GENERIC-NODEBUG，只不过是 `MINIMAL` 版本的。不到 15 行。

## 内核选项说明文件

- [freebsd-src/main/sys/amd64/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/amd64/conf/NOTES)：amd64 机器相关的内核配置说明文件。不到 200 行。
- [freebsd-src/main/sys/x86/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/x86/conf/NOTES)：i386 和 amd64 共用的机器相关配置。650 余行。
- [freebsd-src/main/sys/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main//sys/conf/NOTES)：机器无关的说明，近 2900 行。

## amd64 机器相关的内核配置选项

原文：[freebsd-src/main/sys/amd64/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/amd64/conf/NOTES)，版本 [mpi3mr: Broadcom's MPT-Fusion version 4 is amd64 and aarch64 only](https://github.com/freebsd/freebsd-src/commit/2f721943bf20e53b0ba7b5032a2900d0beb67413)。

>**技巧**
>
>可直接剪切/粘贴内核和 hints 条目到内核配置文件中。


### GCOV (生成覆盖率信息) 

```ini
options 	LINDEBUGFS # ①
options 	GCOV # ②
```

- ① 用于调试的 Linux 文件系统，参见 [lindebugfs(5)](https://man.freebsd.org/cgi/man.cgi?query=lindebugfs&sektion=5)
- ② GCOV 实际上是 llvm-cov，参见 [gcov(1)](https://man.freebsd.org/cgi/man.cgi?query=gcov&sektion=1)


### SMP 

可选设备：

```ini
device		atpic			# 可选兼容 pic 可编程中断控制器，ISA 相关
device		mptable			# 可选的 MPSPEC 多处理器表①
```

- ①：显示多处理器配置表，参见 [mptable(1)](https://man.freebsd.org/cgi/man.cgi?query=mptable&sektion=1)



### CPU

>**技巧**
>
>你必须至少指定一款 CPU（即你打算运行的那款 CPU）；删除那些你不打算使用的 CPU 的配置可能会让系统中的某些部分运行得更快。

```ini
cpu		HAMMER			# HAMMER 是 AMD K8 研发代号，即 Opteron（皓龙）& Athlon64（速龙）
```

### 硬件设备配置


可选设备：

```ini
device		vt_efifb	# EFI framebuffer（帧缓冲）①
```

- ① vt(4) 驱动。参见 [vt(4)](https://man.freebsd.org/cgi/man.cgi?query=vt%284%29&apropos=0&sektion=5)


```ini
device		tdfx			# 启用 3Dfx Voodoo
```

3Dfx Voodoo Graphics、Voodoo II 的 /dev/3dfx 字符设备支持（1990 年代的产品）。将创建设备 `/dev/3dfx0` ，以便与 Glide 实现一起使用。该设备应链接到 `/dev/3dfx` 和 `/dev/voodoo`。请注意，这与 XFree86 的 tdfx DRI 模块不同，完全无关。


#### RAID 适配器

```ini
#device	pst
```

Promise Supertrak SX6000 的设备驱动程序

```ini
device		smartpqi
```

Microsemi smartpqi 控制器。这些控制器有类似 SCSI 的接口，并且需要 CAM 基础设施。


```ini
device		mpi3mr			# LSI-Logic MPT-Fusion 4
```

Broadcom MPT Fusion，第 4 版，仅支持 64 位。

#### 网络接口

```ini
device		axp	    # AMD EPYC 集成网卡，依赖 miibus 模块
device		ixl	    # Intel 700 Series Physical Function，依赖 ice_ddp 模块
device		iavf 	  # Intel Adaptive Virtual Function
device		ice		  # Intel 800 Series Physical Function
device		ice_ddp	# Intel 800 Series DDP Package
device		irdma		# Intel 800 Series RDMA 驱动，依赖 ice 模块
device		qlxgb		# QLogic 3200/8200 10Gb 以太网 & CNA 适配器
device		qlxgbe	# QLogic 8300 10Gb 以太网 & CNA 适配器
device		qlxge		# QLogic 8100 系列 10Gb 以太网 & CNA 适配器
device		qlnxe		# QLogic 41000/45000 以太网系列 10/25/40/100 GbE 以太网与 CNA 适配器
device		sfxge		# Solarflare SFC9000 系列 10Gb 以太网
```

#### 其他硬件

```ini
device		ioat		# Intel I/OAT DMA 引擎
```

Intel I/O 加速技术支持

```ini
options 	EFIRT
```

EFI 运行时服务支持

```ini
device		efidev
```

EFI 伪设备

```ini
device		efirtc
```

EFI RTC（实时时钟）

```ini
device		qat_c2xxx
```

带 OpenCrypto 支持的 Intel QuickAssist 驱动，仅支持 Atom C2XXX 芯片组。

```ini
options 	XENHVM		# Xen HVM 内核基础设施
device		xenefi		# Xen EFI 定时器驱动
device 		xenpci		# Xen HVM Hypervisor 服务驱动
device		xentimer	# Xen x86 PV 定时器驱动
```

Xen HVM 虚拟机优化。

### ABI 仿真

```ini
options 	COMPAT_FREEBSD32
```

启用 FreeBSD / i386 二进制文件的 32-bit 运行时支持。

```ini
options 	COMPAT_AOUT
```

启用 （32-bit） a.out 二进制文件支持。


### ZFS

>**注意**
>
>这取决于 crypto、cryptodev 和 ZSTDIO。

```ini
options 	ZFS
```

### VM

```ini
options 	NKPT=31
```

用于早期引导的初始内核页表页数量。这个数量应包含足够的页，以映射内核以及加载器随内核加载的任何模块或其他数据。每个页表页映射 2 MB。

```ini
options 	KSTACK_PAGES=5
```

KSTACK_PAGES 是为每个线程的内核栈分配的内存页数量。


```ini
options 	PV_STATS
```

启用 PV entry 分配器的详细记账功能。

### 内核清理器（sanitizers）

```ini
#options	COVERAGE	# 通用内核覆盖率。KCOV 会依赖此选项
#options	KCOV			# 内核覆盖率清理器
#options	KUBSAN		# 内核未定义行为清理器 ①
#options	KCSAN			# 内核并发清理器
#options	KASAN			# 内核地址清理器
#options	KCSAN			# 内核并发清理器
#options	KMSAN			# 内核内存清理器
```

- ① 警告：KUBSAN 可能会导致内核过大，以至于 loader 无法加载。

## i386 和 amd64 共用的机器相关内核选项

原文 [freebsd-src/main/sys/x86/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/x86/conf/NOTES)，版本 [NOTES: Add iwm and iwx](https://github.com/freebsd/freebsd-src/commit/b1039bbe185bbadea24207b600f4bea065a2dbee)。

>**技巧**
>
>可直接剪切/粘贴内核和 hints 条目到内核配置文件中。


### DTrace

```ini
#options 	KDTRACE_HOOKS
```

启用内核 DTrace hooks，DTrace 模块依赖此选项。

```ini
#device		dtrace
```

DTrace 核心。

>**注意**
>
>这将会把 CDDL 许可下的组件（DTrace）引入内核。


```ini
#device		dtrace_profile
#device		dtrace_sdt
#device		dtrace_fbt
#device		dtrace_systrace
#device		dtrace_prototype
#device		dtnfscl
#device		dtmalloc
```

各种 DTrace 模块。

```ini
#device		dtraceall
```

可选项，加载以上所有 DTrace 模块。
 

### SMP

```ini
options 	IPI_PREEMPTION
```

可选项。

>**注意**
>
>`IPI_PREEMPTION` 指示内核在需要时抢占其他 CPU 上运行的线程。该功能依赖 `PREEMPTION`。

```ini
options 	COUNT_XINVLTLB_HITS	# TLB 事件计数器
options 	COUNT_IPIS		# 每 CPU IPI 中断计数器
```

调试选项。
 

### 兼容性


```ini
options 	COMPAT_43
```
 
实现与 4.3BSD、FreeBSD 1.x 及 2.x 的 a.out 二进制文件兼容的系统调用。ELF 二进制文件或更新的 a.out 二进制文件无需此功能。

### 网络支持

```ini
options 	DEVICE_POLLING
```

`DEVICE_POLLING` 为网络设备驱动程序添加了中断与轮询混合处理支持，该功能在应对过载的健壮性、系统响应性以及在内核网络处理与其他活动之间实现精确的 CPU 时间调度方面具有显著优势。其缺点在于响应时间可能适度增加（最多可达 1/HZ 秒）。

强烈建议在使用 DEVICE_POLLING 时将 HZ 设置为 1000 或 2000 以获得更平滑的运行表现。此外，您可以在运行时通过 ifconfig(8) 工具启用/禁用轮询功能，并通过 sysctl 变量 `kern.polling.user_frac`（默认值 50，范围 0 到 100）调整保留给用户空间的 CPU 时间比例。需要注意的是，在本文撰写时，并非所有设备驱动程序都支持此工作模式。更多详细信息请参阅 polling(4)。

```ini
options 	BPF_JITTER
```
 
`BPF_JITTER` 为 BPF 添加了即时编译器支持。


### 时钟

```ini
device		nvram		# 通过 /dev/nvram 访问 rtc cmos
```

提供对时钟芯片内存的读写访问。
 

### 其他杂项设备与选项

```ini
device		speaker	
envvar		hint.speaker.0.at="isa"
envvar		hint.speaker.0.port="0x61"
```

通过扬声器播放 IBM BASIC 风格的提示音。
 
#### 硬件总线配置

```ini
options 	IOMMU			
```

启用 IOMMU。

```ini
device		isa
```
启用 ISA 总线。

```ini
options 	AUTO_EOI_1
#options 	AUTO_EOI_2

options 	MAXMEM=(128*1024)
#options 	BROKEN_KEYBOARD_RESET
```

ISA 总线选项。

`AUTO_EOI_1` 为主 8259A 中断控制器启用“自动 EOI”功能。每次中断可节省约 0.7-1.25 微秒。此选项会破坏部分便携式设备的挂起/恢复功能。

`AUTO_EOI_2` 为从 8259A 中断控制器启用“自动 EOI”功能。每次中断可节省约 0.7-1.25 微秒。文档记载自动 EOI 在原始 i8259A 芯片的从控制器上无效，但部分克隆芯片和集成版本可正常使用。

`MAXMEM` 用于指定机器内存容量。若未指定该参数，FreeBSD 将首先从 CMOS RAM 读取内存容量，此时初始内存将被限制在 64MB 或 16MB（具体取决于 BIOS）。若 BIOS 报告 64MB，系统将通过内存探测尝试检测实际安装的内存容量。若探测失败且内存大于 64MB，则必须使用 `MAXMEM` 参数。容量值以千字节为单位，例如 128MB 内存需设置为 131072（128 * 1024）。

`BROKEN_KEYBOARD_RESET` 可禁用通过键盘控制器执行 CPU 复位重启的功能。此选项适用于键盘控制器存在故障的系统。

```ini
device		agp
```

AGP GART 支持。


```ini
options 	AGP_DEBUG
```

AGP 调试。

#### ACPI

```ini
device		acpi
options 	ACPI_DEBUG
```

ACPI 支持（基于英特尔 ACPI 组件架构参考实现）

`ACPI_DEBUG` 可通过内核环境变量 `debug.acpi.level` 与 `debug.acpi.layer` 来设置英特尔 ACPICA 代码的初始调试级别（注意：此功能需在英特尔代码编译时启用选项 `USE_DEBUGGER`）


```ini
device		acpi_wmi
```

ACPI WMI 映射驱动程序


```ini
device		acpi_asus
```

面向华硕的 ACPI 扩展功能（LCD 背光/亮度、视频输出等）

```ini
device		acpi_fujitsu
```

面向富士通的 ACPI 扩展功能（按键）

```ini
device		acpi_hp
```

面向惠普笔记本的 ACPI 扩展驱动

```ini
device		acpi_ibm
```
面向 IBM 笔记本（ThinkPad）的 ACPI 扩展驱动

```ini
device		acpi_panasonic
```

面向松下的 ACPI 扩展功能（LCD 背光/亮度、视频输出等）

```ini
device		acpi_sbl_wmi
```

ACPI SBL 固件更新

```ini
device		acpi_sony
```

面向索尼的 ACPI 扩展功能（LCD 亮度调节）

```ini
device		acpi_toshiba
```

面向东芝的 ACPI 扩展功能（LCD 背光/亮度、视频输出等）

```ini
device		acpi_video
```

ACPI 视频扩展功能（LCD 背光/亮度、视频输出等）

```ini
device		acpi_dock
```

ACPI 扩展坞支持

```ini
device		aibs
```

ACPI ASOC ATK0110 华硕 AI Booster（电压、温度与风扇传感器）
 
#### 硬件设备配置

##### 可选设备

```ini
device		sc
envvar		hint.sc.0.at="isa"
options 	MAXCONS=16		# 虚拟控制台数量
options 	SC_ALT_MOUSE_IMAGE	# 文本模式下的简化鼠标光标
options 	SC_DFLT_FONT		# 编译内置字体
makeoptions	SC_DFLT_FONT=cp850
options 	SC_DFLT_TERM=\"sc\"	# 默认的终端模拟器
options 	SC_DISABLE_KDBKEY	# 禁用 `debug' 调试键
options 	SC_DISABLE_REBOOT	# 禁用重启快捷键
options 	SC_HISTORY_SIZE=200	# 历史缓冲区行数
options 	SC_MOUSE_CHAR=0x3	# 文本模式鼠标光标字符代码
options 	SC_PIXEL_MODE		# 添加对光栅文本模式的支持
```

syscons 控制台驱动程序（兼容 SCO 彩色控制台）。

```ini
options 	SC_NORM_ATTR=(FG_GREEN|BG_BLACK)
options 	SC_NORM_REV_ATTR=(FG_YELLOW|BG_GREEN)
options 	SC_KERNEL_CONS_ATTR=(FG_RED|BG_BLACK)
options 	SC_KERNEL_CONS_ATTRS=\"\x0c\x0d\x0e\x0f\x02\x09\x0a\x0b\"
options 	SC_KERNEL_CONS_REV_ATTR=(FG_BLACK|BG_RED)
```

以上选项可用于调整 syscons 的默认颜色配置。

sc 的 `flags` 参数：
- `0x80` 将显卡设置为 VESA 800x600 点阵 16 色模式
- `0x100` 若未检测到键盘设备则进行周期性探测

```ini
options 	SC_CUT_SPACES2TABS	# 将前导空格转换为制表符
options 	SC_CUT_SEPCHARS=\"x09\"	# 单词分隔符字符集（默认为单个空格 - "x20"）
```

以上选项可用于修改剪切粘贴功能的默认行为。

```ini
options 	SC_TWOBUTTON_MOUSE
```

若使用双键鼠标，可添加以上选项来启用鼠标右键粘贴文本的功能。

```ini
options 	SC_NO_CUTPASTE
options 	SC_NO_FONT_LOADING
options 	SC_NO_HISTORY
options 	SC_NO_MODE_CHANGE
options 	SC_NO_SYSMOUSE
options 	SC_NO_SUSPEND_VTYSWITCH
#!options 	SC_NO_TERM_DUMB
#!options 	SC_NO_TERM_SC
#!options 	SC_NO_TERM_SCTEKEN
```

可选择性禁用 syscons 中的功能模块。

```ini
device		splash
```

启动画面与屏幕保护程序。


```ini
device		blank_saver
device		daemon_saver
device		dragon_saver
device		fade_saver
device		fire_saver
device		green_saver
device		logo_saver
device		rain_saver
device		snake_saver
device		star_saver
device		warp_saver
```

多种屏幕保护程序。

```ini
options 	VESA
```

VGA VESA 显示模式。

```ini
options 	VESA_DEBUG
```

启用针对 VESA 支持的额外调试检查与输出。

```ini
device		dpms		
```

通过 VESA BIOS 实现 DPMS（VESA 显示电源管理信号）挂起与恢复功能。

```ini
options 	X86BIOS
```
x86 实模式 BIOS 模拟器（atkbdc/dpms/vesa 功能依赖于此）。


```ini
device		psm
envvar		hint.psm.0.at="atkbdc"
envvar		hint.psm.0.irq="12"
```

PS/2 鼠标。


```ini
options 	PSM_HOOKRESUME		
```

psm 选项。

在系统恢复事件时重置设备（对部分笔记本电脑特别有用）。


```ini
device		atkbdc
envvar		hint.atkbdc.0.at="isa"
envvar		hint.atkbdc.0.port="0x060"
```

键盘控制器：该组件负责控制键盘与 PS/2 鼠标。

```ini
device		atkbd
envvar		hint.atkbd.0.at="atkbdc"
envvar		hint.atkbd.0.irq="1"
```

AT 键盘。


```ini
options 	ATKBD_DFLT_KEYMAP	# 指定内置键盘布局
makeoptions	ATKBD_DFLT_KEYMAP=fr.dvorak
```

atkbd 驱动选项。

atkbd 的 flags 参数：
- `0x01` 强制检测键盘（默认始终假设存在键盘）
- `0x02` 禁止重置键盘（适用于部分新型 ThinkPad）
- `0x03` 强制检测且避免重置（可能有助于特定扩展坞兼容性）
- `0x04` 启用旧式（XT）键盘支持（适用于旧款 ThinkPad）

```ini
device		vga
envvar		hint.vga.0.at="isa"
```

VGA 适配器显卡驱动程序

```ini
options 	VGA_ALT_SEQACCESS
```

vga 驱动选项：若鼠标指针显示异常或字体加载不正确，可尝试以上选项（可能在某些系统上引发屏幕闪烁）。

.

```ini
#options 	VGA_NO_FONT_LOADING	# 不保存/不加载字体
#options 	VGA_NO_MODE_CHANGE	# 不更改显示模式
```

若需节省内存空间，可通过以上选项禁用部分 vga 驱动程序功能。

```ini
options 	VGA_SLOW_IOACCESS	# 
```

对 TS 与 GDC 寄存器执行字节宽度 I/O 操作。较旧的显卡可能需要此选项以确保正常运行。

```ini
options 	VGA_WIDTH90
```

支持 90 列模式。以上选项可能不适用于 LCD 显示屏。

```ini
options 	VGA_DEBUG
```

调试器。

```ini
device		vt_vga		# VGA
device		vt_vbefb	# VBE framebuffer
```

vt(4) 驱动。

```ini
device		s3pci
```

基于 VESA 的 S3 VESA 1.2 显卡线性帧缓冲驱动程序


#### RAID 适配器

```ini
device		arcmsr		# Areca SATA II RAID
```

Areca 11xx 与 12xx 系列 SATA II RAID 控制器（需启用 CAM 子系统）。


```ini
device		aac
device		aacp	# SCSI 直通接口（可选功能，需启用 CAM 子系统）
```

Adaptec FSA RAID 控制器系列，包含戴尔集成控制器、戴尔 PERC 2/QC 及惠普 NetRAID-4M。

```ini
# Highpoint RocketRAID 27xx
device		hpt27xx

# Highpoint RocketRAID 182x
device		hptmv

# Highpoint DC7280 和 R750
device		hptnr

# Highpoint RocketRAID.  支持 RR172x, RR222x, RR2240, RR232x, RR2340, RR2210, RR174x, RR2522, RR231x, RR230x
device		hptrr

# Highpoint RocketRaid 3xxx 系列 SATA RAID
device		hptiop
```

Highpoint 相关设备。

```ini
device		ips
```

IBM (now Adaptec) ServeRAID 控制器


```ini
device		isci
options 	ISCI_LOGGING	# 在 isci HAL 中启用调试功能
```

英特尔 C600（Patsburg）集成 SAS 控制器

```ini
device		vmd
```
英特尔卷管理设备 (VMD) 支持。

```ini
device		pmspcv
```

PMC-Sierra SAS/SATA 控制器。

#### 软盘

```ini
device		fdc
envvar		hint.fdc.0.at="isa"
envvar		hint.fdc.0.port="0x3F0"
envvar		hint.fdc.0.irq="6"
envvar		hint.fdc.0.drq="2"
```

标准软盘控制器与软盘磁带驱动器，支持 Y-E DATA 外置 FDD（PC 卡）。

```ini
options 	FDC_DEBUG
```

FDC_DEBUG 可启用软盘调试功能。由于调试输出量极大，需通过 DDB 设置 fd_debug 变量方可激活。

```ini
#hint.fdc.0.flags="1"
```

若您使用 Insight 的软盘磁带设备，请激活此配置项。由于仅配置软盘的用户进行设备探测存在风险，此功能已通过标志位进行隔离保护。

```ini
envvar		hint.fd.0.at="fdc0"
envvar		hint.fd.0.drive="0"
envvar		hint.fd.1.at="fdc0"
envvar		hint.fd.1.drive="1"
```

指定软盘设备

#### CPU 频率控制

```ini
device		cpufreq
```

cpufreq(4) 驱动程序提供了对非 ACPI CPU 频率控制的支持。

#### 网卡

```ini
device		bxe		# 博通 NetXtreme II BCM5771X/BCM578XX 10GbE 以太网卡
device		gve		# 谷歌虚拟网卡 (gVNIC)
device		igc		# Intel I225 2.5G Ethernet
device		ipw		# Intel 2100 无线网卡（Intel PRO/Wireless 2100 IEEE 802.11 适配器），依赖 ipw 固件
device		iwi		# Intel 2200BG/2225BG/2915ABG 无线网卡（Intel PRO/Wireless 2200BG/2225BG/2915ABG IEEE 802.11 适配器），依赖 iwi 固件
device		iwm		# Intel IEEE 802.11ac 无线网卡（Intel Wireless WiFi Link 1000/105/135/2000/4965/5000/6000/6050 abgn 802.11 网络适配器），依赖 iwm 固件
device		iwn		# Intel 4965/1000/5000/6000 无线网卡
device		iwx		# Intel IEEE 802.11ax 无线网卡
device  	mthca		# Mellanox HCA InfiniBand
device  	mlx4		# InfiniBand 与以太网共用的代码模块
device  	mlx4ib		# Mellanox ConnectX HCA InfiniBand
device  	mlx4en		# Mellanox ConnectX HCA Ethernet
device		nfe		# 英伟达 nForce MCP 板载以太网（以 BSD 开源）
device		vmx		# VMware VMXNET3 以太网（以 BSD 开源）
device		wpi		# Intel 3945ABG 无线网卡（Intel 3945ABG 无线局域网控制器），依赖 wpi 固件
```

#### IEEE 802.11 适配器固件


```ini
device		iwifw
device		iwibssfw
device		iwiibssfw
device		iwimonitorfw
device		ipwfw
device		ipwbssfw
device		ipwibssfw
device		ipwmonitorfw
device		iwnfw
device		iwn1000fw
device		iwn105fw
device		iwn135fw
device		iwn2000fw
device		iwn2030fw
device		iwn4965fw
device		iwn5000fw
device		iwn5150fw
device		iwn6000fw
device		iwn6000g2afw
device		iwn6000g2bfw
device		iwn6050fw
device		wpifw
```

Intel PRO/Wireless 2100 固件：

- ipwfw - 支持 BSS/IBSS/监听模式的全功能固件
- ipwbssfw - 仅支持 BSS 模式固件
- ipwibssfw - 仅支持 IBSS 模式固件
- ipwmonitorfw - 仅支持监听模式固件

Intel PRO/Wireless 2200BG/2225BG/2915ABG 固件：

- iwifw - 支持 BSS/IBSS/监听模式的全功能固件
- iwibssfw - 仅支持 BSS 模式固件
- iwiibssfw - 仅支持 IBSS 模式固件
- iwimonitorfw - 仅支持监听模式固件

Intel Wireless WiFi Link 4965/1000/5000/6000 系列固件：

- iwnfw - 支持所有该系列设备的单一模块
- iwn1000fw - 仅适用于 1000 的特定模块
- iwn105fw - 仅适用于 105 的特定模块
- iwn135fw - 仅适用于 135 的特定模块
- iwn2000fw - 仅适用于 2000 的特定模块
- iwn2030fw - 仅适用于 2030 的特定模块
- iwn4965fw - 仅适用于 4965 的特定模块
- iwn5000fw - 仅适用于 5000 的特定模块
- iwn5150fw - 仅适用于 5150 的特定模块
- iwn6000fw - 仅适用于 6000 的特定模块
- iwn6000g2afw - 仅适用于 6000g2a 的特定模块
- iwn6000g2bfw - 仅适用于 6000g2b 的特定模块
- iwn6050fw - 仅适用于 6050 的特定模块

其他：

- wpifw - Intel 3945ABG 无线局域网控制器固件


#### 非透明桥 (NTB) 驱动程序

```ini
device		if_ntb		# 虚拟 NTB 网卡
device		ntb_transport	# NTB 数据包传输驱动程序
device		ntb		# NTB 硬件接口
device		ntb_hw_amd	# AMD NTB 硬件驱动
device		ntb_hw_intel	# Intel NTB 硬件驱动
device		ntb_hw_plx	# PLX NTB 硬件驱动
```

#### 其他硬件


```ini
device		ipmi    # 智能平台管理接口
device		pbio    # 并行（8255 PPI）基本 I/O（模式 0）端口（例如 Advantech PCL-724）
envvar		hint.pbio.0.at="isa"
envvar		hint.pbio.0.port="0x360"
device		smbios  # DMI/SMBIOS 入口点（需启用 EFIRT 选项）
device		vpd # 重要产品数据内核接口
device		asmc    # 苹果系统管理控制器
device		tpm # 可信平台模块
device		rdrand_rng	# 英特尔 Bull Mountain 随机数生成器
device		aesni		# AES-NI OpenCrypto 模块
device		ossl		# OpenSSL OpenCrypto 模块
```

Specialix SI/XIO 驱动程序注意事项：
- 主机卡采用内存映射（非 I/O 映射）
- Rev 1 主机卡使用 64K 内存块，对齐边界为 32K
- Rev 2 主机卡使用 32K 内存块，对齐边界为 32K
- 该系列卡支持使用 IRQ 11、12 或 15

```ini
device		kvm_clock	# KVM 半虚拟化时钟驱动程序
```

Linux KVM 半虚拟化支持。


```ini
device 		hyperv		# Hyper-V 驱动
device		hvhid		# Hyper-V HID 驱动

微软 Hyper-V 增强支持

```ini
device		pvscsi		# 半虚拟化 SCSI 驱动程序
device		vmci		# 虚拟机通信接口（VMCI）
device		vmware_guestrpc	# GuestRPC 接口
```

VMware 虚拟机监控程序支持。

```ini
device backlight
```

笔记本电脑专用选项。背光亮度调节。

```ini
device		imcsmb
```

系统管理总线（SMB）。

支持的 SMBus 接口：
- imcsmb：集成内存控制器 (iMC) SMBus 控制器。
 - 支持平台：Sandy Bridge-至强、Ivy Bridge-至强、Haswell-至强、Broadwell-至强处理器

```ini
device		iichid		# HID-over-I²C 支持
options 	IICHID_DEBUG	# 启用 HID-over-I²C 调试信息
options 	IICHID_SAMPLING	# 针对缺失 GPIO 中断支持的变通方案
```

HID-over-I²C 支持。

```ini
device		amdsmn
```

AMD 系统管理网络（AMD System Management Network, SMN）

```ini
device		ichwd   # 英特尔 ICH 看门狗定时器
device		amdsbwd # AMD SB7xx 看门狗定时器
device		viawd   # VIA 南桥看门狗定时器
device		wbwd    # Winbond 看门狗定时器
device		itwd    # ITE Super I/O 看门狗定时器
```

硬件看门狗定时器。

```ini
device		coretemp
device		amdtemp
```

温度传感器：
- `coretemp`：英特尔酷睿及更新架构处理器晶圆的内置传感器
- `amdtemp`：AMD K8/K10/K11 系列处理器晶圆的内置传感器

```ini
device		cpuctl
```

CPU 控制伪设备。提供了对 MSR（模型特定寄存器）、CPUID 信息及微代码更新功能的访问。


```ini
device		superio
```

SuperIO 驱动。

```ini
options 	KBDIO_DEBUG=2
options 	KBD_MAXRETRY=4
options 	KBD_MAXWAIT=6
options 	KBD_RESETDELAY=201

options 	PSM_DEBUG=1

options 	TIMER_FREQ=((14318182+6)/12)

options 	VM_KMEM_SIZE
options 	VM_KMEM_SIZE_MAX
options 	VM_KMEM_SIZE_SCALE
```

许多用于代码检查的未公开选项。

>**注意**
>
>对此类选项进行的文档编写并不被视为不当行为。


## 机器无关的内核选项

原文：[freebsd-src/main/sys/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/conf/NOTES)，版本 [random: allow disabling of entropy harvesting from keyboard & mice](https://github.com/freebsd/freebsd-src/commit/d6f10a5d013fdcc92847644ffbaf65cbf491bb39)。


>**技巧**
>
>可直接剪切/粘贴下面的条目到内核配置文件中。
>
>
>>以 `device`、`options`、`machine`、`ident`、`maxusers`、`makeoptions`、`hints` 等开头的行放入要运行 [config(8)](https://man.freebsd.org/cgi/man.cgi?config(8)) 的内核配置中。
>>
>>以 `envvar hint.` 开头的行应放入你的 hints 文件中。参见 `/boot/device.hints`，[config(8)](https://man.freebsd.org/cgi/man.cgi?config(8)) 中的 `hints` 指令。
>>
>>如果你想进行内核测试构建，请使用 `make LINT` 创建旧式 LINT 文件。
>>
>>此文件是机器无关的内核配置说明。机器相关的说明，请参见 `/sys/架构/conf/NOTES`。

>**技巧**
>
>NOTES 约定和风格指南：
>
>大段注释应以仅包含注释字符的一行开始和结束。
>
>描述特定对象时，如果存在块注释，应先写块注释。接下来按顺序写 device、options 和 hints 条目。所有 device 和 option 行都必须有注释，且注释不能只是重复 device 或 option 名称。如可能，仅在同一行使用简明注释。设备和子系统的详细说明应放在 man 页中。
>
>options 与选项名之间用一个空格加一个制表符分隔。device 与设备名之间用两个空格加一个制表符分隔。option 或 device 后的注释应在注释字符后加一个空格。要注释掉禁用代码的负选项（因此不应在 LINT 构建中启用），在 `options` 前加 `#!`。

```ini
ident		LINT
```

这是内核的“标识”。通常应与内核的名称相同。

```ini
maxusers	10
```

参数 `maxusers` 可通过 `subr_param.c` 中定义的公式控制多个内部系统表的静态大小。

省略此参数或将其设置为 `0`，系统将根据物理内存自动调整大小。

```ini
#hints		"LINT.hints"		# 查找设备的默认位置
```

静态编译设备连接，而不是使用 `/boot/device.hints`。

```ini
#env		"LINT.env"
```

使用以上方法将值编译进内核，以便内核可以通过 `getenv()`（或者用户空间的 `kenv(1)`）访问。文件格式为 `variable=value`，详见 [kenv(1)](https://man.freebsd.org/kenv(1))。

```ini
makeoptions	CONF_CFLAGS=-fno-builtin  # ①② 不允许使用 memcmp 等函数
#makeoptions	DEBUG=-g		# ③ 为内核构建包含 gdb(1) 调试符号的版本
#makeoptions	KERNEL=foo		# ④ 构建内核 "foo" 并安装到 "/foo"
#makeoptions	MODULES_OVERRIDE="ext2fs sound/sound sound/driver/maestro3" # ⑤ 只构建 ext2fs 模块以及我需要的声音系统部分。
makeoptions	DESTDIR=/tmp # 将目标安装目录临时设置为 /tmp
```

- ①：`makeoptions` 参数可将变量传递给构建区域生成的 Makefile。

- ②：`CONF_CFLAGS` 提供了一些额外的编译器标志，这些标志会在大多数其他标志之后添加到 `${CFLAGS}` 中。在这里，我们使用它来禁止使用非最优的 gcc 内建函数（例如 `memcmp`）。

- ③：`DEBUG` 是个特殊标志。

下面的做法等同于执行 `config -g KERNELNAME`，会生成 `kernel.debug`，该内核带有调试信息 `-g`，同时还会生成一个普通的 `kernel`。使用 `make install.debug` 可以安装调试内核，但通常没有必要，因为调试符号不会被内核加载，在内核中也没有用处。

- ④：重命名 `KERNEL`，以便于让你更改内核的默认名称。

- ⑤：`MODULES_OVERRIDE` 可以用来限制构建的模块列表，仅编译指定的模块。

```ini
options 	MAXDSIZ=(1024UL*1024*1024)
options 	MAXSSIZ=(128UL*1024*1024)
options 	DFLDSIZ=(1024UL*1024*1024)
```

FreeBSD 进程在使用系统资源时会受到一定限制。更多细节，请参见 [getrlimit(2)](https://man.freebsd.org/getrlimit(2))。每个资源限制都有两个值：“软限制（soft limit）”和“硬限制（hard limit）”。

可以在系统正常运行时修改软限制，而硬限制只能在启动时设定。它们的默认值定义在 `sys/架构/include/vmparam.h` 中。有两种方式可以修改上述限制：

1. 在内核编译时设置值。下面的选项是一种将该限制提高到 1GB 的方法。通过修改相关参数，还可以进一步提高这些值。
2. 在 `/boot/loader.conf` 中设置可调节参数：`kern.maxswzone`、`kern.maxbcache`、`kern.maxtsiz`、`kern.dfldsiz`、`kern.maxdsiz`、`kern.dflssiz`、`kern.maxssiz` 和 `kern.sgrowsiz`。

`/boot/loader.conf` 中的设置会覆盖内核配置文件中的任何值。有关更多细节，请参见 `sys/kern/subr_param.c` 中的函数 `init_param1`。


```ini
options 	BLKDEV_IOSIZE=8192
```

`BLKDEV_IOSIZE` 可设置用户块设备 I/O 使用的默认块大小。

>**注意**
>
>当通过带有非零分区块大小的标签指定块设备时，该值会被标签覆盖。默认值为 `PAGE_SIZE`。

```ini
options 	DFLTPHYS=(64*1024) # DFLTPHYS 表示原始（raw）I/O 块设备访问的安全大小，默认值 64K
options 	MAXPHYS=(128*1024) # MAXPHYS 表示原始（raw）I/O 块设备访问的最大大小，默认值 128K
```

对于已知可靠的设备，读写操作会被分割成 MAXPHYS 大小的块；对于其他设备，则使用 DFLTPHYS 大小的块。某些应用在使用较大原始 I/O 访问块时性能更好。

>**注意**
>
>某些虚拟内存（VM）参数是从这些值推导出来的，将它们设置得过大可能会导致内核无法启动。

```ini
options 	INCLUDE_CONFIG_FILE     # 将此文件内置进内核
```

你可将此配置文件实际存储到内核二进制文件中。详见 config(8)。


```ini
options 	BOOTVERBOSE=1
options 	BOOTHOWTO=RB_MULTIPLE
```

各种启动参数的编译时默认值


```ini
options 	BOOT_TAG=\"\"
```

dmesg 启动标签的编译时默认值

默认启动标签；可以使用 loader 可调参数 `kern.boot_tag` 来覆盖。当前启动的标签也通过 sysctl `kern.boot_tag` 暴露。


```ini
options 	BOOT_TAG_SZ=32
```

内核静态缓冲区应容纳的最大启动标签大小。BOOT_TAG 及其相关可调参数的最大尺寸。


```ini
options 	GEOM_CACHE		# 磁盘缓存
options 	GEOM_CONCAT		# 磁盘串联
options 	GEOM_ELI		# 磁盘加密
options 	GEOM_GATE		# 用户态服务
options 	GEOM_JOURNAL		# 日志功能
options 	GEOM_LABEL		# 提供者标签化
options 	GEOM_LINUX_LVM		# Linux LVM2 卷
options 	GEOM_MAP		# 基于映射的分区
options 	GEOM_MIRROR		# 磁盘镜像
options 	GEOM_MULTIPATH		# 磁盘多路径
options 	GEOM_NOP		# 测试类
options 	GEOM_PART_APM		# Apple 分区
options 	GEOM_PART_BSD		# BSD 磁盘标签
options 	GEOM_PART_BSD64		# BSD 磁盘标签64
options 	GEOM_PART_EBR		# 扩展启动记录
options 	GEOM_PART_GPT		# GPT 分区
options 	GEOM_PART_LDM		# 逻辑磁盘管理器
options 	GEOM_PART_MBR		# MBR 分区
options 	GEOM_RAID		# 软件 RAID 功能
options 	GEOM_RAID3		# RAID3 功能
options 	GEOM_SHSEC		# 共享密钥
options 	GEOM_STRIPE		# 磁盘条带化
options 	GEOM_UZIP		# 只读压缩磁盘
options 	GEOM_VIRSTOR		# 虚拟存储
options 	GEOM_ZERO		# 性能测试辅助工具
```

GEOM 相关。


```ini
options 	ROOTDEVNAME=\"ufs:da0s2e\"
```

可以在编译时指定根设备和文件系统类型；如果引导程序无法正确识别根设备，此处提供了备用方案；或在启动内核时指定 `RB_DFLTROOT` 标志（`-r`）时来覆盖选项。

### 调度器

```ini
options 	SCHED_4BSD # 历史悠久、久经考验的 BSD 调度器
options 	SCHED_STATS # 统计信息
#options 	SCHED_ULE # 默认的 ULE 调度器
```

`SCHED_4BSD` 和 `SCHED_ULE` 必选其一。这些选项用于选择要编译进内核的调度器。

说明：

- `SCHED_4BSD` 使用全局运行队列且没有 CPU 亲和性，这在 SMP 系统中表现不佳。但它具有非常好的交互性和优先级选择能力。
- `SCHED_ULE` 在许多 SMP 机器上的工作负载下，相比 4BSD 提供了显著的性能优势。它支持 CPU 亲和性、每 CPU 的运行队列和调度器锁。它还对交互性有更强的支持，即使在单处理器机器上也能提供更好的响应能力。
- `SCHED_STATS` 会在 sysctl `kern.sched.stats` 下保存一些统计信息，有助于调试调度决策。

### SMP 


```ini
options 	SMP			# Symmetric MultiProcessor Kernel,对称多处理器
```

SMP 可构建对称多处理器内核。必须指定。

```ini
options 	EARLY_AP_STARTUP
```

`EARLY_AP_STARTUP` 可在内核启动过程中更早地释放应用处理器（在设备探测之前），而不是在启动尽头。这个选项是从晚期到早期 AP 启动过渡期间的临时选项。

```ini
options 	MAXCPU=32
```

`MAXCPU` 定义了系统中能启动的最大 CPU 数量。每种架构通常已经有默认值。

```ini
options 	NUMA
```

NUMA 可启用内核各子系统中对非一致性内存访问（Non-Uniform Memory Access）策略的支持。

```ini
options 	MAXMEMDOM=2
```

`MAXMEMDOM` 定义了系统中可启动的最大内存域数量。每种架构通常已有默认值。


```ini
options 	NO_ADAPTIVE_MUTEXES
```

`ADAPTIVE_MUTEXES` 可改变阻塞互斥锁的行为：如果当前持有互斥锁的线程在另一 CPU 上执行，则互斥锁会自旋。此行为默认启用，该选项可用于禁用上述行为。

```ini
options 	NO_ADAPTIVE_RWLOCKS
```

`ADAPTIVE_RWLOCKS` 会改变读写锁的行为：如果当前持有读写锁的线程在另一 CPU 上执行，则锁会自旋。此行为默认启用，该选项可用于禁用上述行为。


```ini
options 	NO_ADAPTIVE_SX
```

`ADAPTIVE_SX` 可改变 sx 锁的行为：如果当前持有 sx 锁的线程在另一 CPU 上执行，则锁会自旋。此行为默认启用，该选项可用于禁用上述行为。

```ini
options 	MUTEX_NOINLINE
```

`MUTEX_NOINLINE` 可强制互斥操作通过调用函数来执行每个操作，而不是对简单情况进行内联。可用于减小内核文本段的大小。

>**注意**
>
>这种行为已被选项 `INVARIANT_SUPPORT`、`INVARIANTS`、`KTR`、`LOCK_PROFILING` 和 `WITNESS` 隐式启用。

```ini
options 	RWLOCK_NOINLINE
```

`RWLOCK_NOINLINE` 可强制读写锁操作通过调用函数来执行每个操作，而不是对简单情况进行内联。可用于减小内核文本段的大小。

>**注意**
>
>这种行为已被选项 `INVARIANT_SUPPORT`、`INVARIANTS`、`KTR`、`LOCK_PROFILING` 和 `WITNESS` 隐式启用。

```ini
options 	SX_NOINLINE
```

`SX_NOINLINE` 可强制 sx 锁操作通过调用函数来执行每个操作，而不是对简单情况进行内联。这可以用于减小内核文本段的大小。

>**注意**
>
>这种行为已被选项 `INVARIANT_SUPPORT`、`INVARIANTS`、`KTR`、`LOCK_PROFILING` 和 `WITNESS` 隐式启用。

#### SMP 调试选项

```ini
options 	PREEMPTION
options 	FULL_PREEMPTION
options 	WITNESS
options 	WITNESS_KDB
options 	WITNESS_SKIPSPIN
```

* `CALLOUT_PROFILING`：启用对 [callout(9)](https://man.freebsd.org/callout(9)) 后端使用的 callwheel 数据结构的基础分析。
* `PREEMPTION`：允许内核中的线程被优先级更高的[中断]线程抢占。提高交互性，使中断线程能更快运行，而不是等待。
* `FULL_PREEMPTION`：指示内核抢占非实时内核线程。主要用于在开发阶段暴露竞态条件和其他 bug。启用会降低性能并增加内核 panic 频率。依赖 `PREEMPTION` 选项，不建议开启。
* `SLEEPQUEUE_PROFILING`：对保存活动睡眠队列的哈希表及睡眠等待消息频率进行基础分析。
* `TURNSTILE_PROFILING`：对保存活动锁队列的哈希表进行基础分析。
* `UMTX_PROFILING`：对保存活动锁队列的哈希表进行基础分析。
* `WITNESS`：启用 witness 代码，用于检测锁操作期间的死锁和循环。
* WITNESS_KDB：当发生锁层次违规或线程在休眠前持锁时，进入内核调试器。
* WITNESS_SKIPSPIN：禁用对自旋互斥锁的 witness 检查。

```ini
options 	LOCK_PROFILING
```

LOCK_PROFILING — 锁分析。详情见 [LOCK_PROFILING(9)](https://man.freebsd.org/cgi/man.cgi?LOCK_PROFILING)。

```ini
options 	MPROF_BUFFERS="1536" # 设置缓冲区数量
options 	MPROF_HASH_SIZE="1543"# 设置缓冲区哈希表大小
```

`MPROF_HASH_SIZE` 哈希表大小必须大于缓冲区数量 `MPROF_BUFFERS`，且应为素数。

```ini
options 	CALLOUT_PROFILING
```

为 [callout(9)](https://man.freebsd.org/callout(9)) 后端进行分析。

```ini
options 	SLEEPQUEUE_PROFILING
options 	TURNSTILE_PROFILING
options 	UMTX_PROFILING
```

对内部哈希表进行分析。

```ini
options 	EPOCH_TRACE
```

针对 [epoch(9)](https://man.freebsd.org/epoch(9)) 的误用进行调试跟踪。

### 兼容性

```ini
options 	COMPAT_43TTY
```

旧款 TTY 接口

```ini
options 	COMPAT_FREEBSD4
```

启用 FreeBSD4 兼容性系统调用。

>**注意**
>
>在通常情况下，`COMPAT_FREEBSD<n>` 依赖 `COMPAT_FREEBSD<n+1>`、`COMPAT_FREEBSD<n+2>` 等。

```ini
options 	COMPAT_FREEBSD5
```

启用 FreeBSD 5 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD6
```

启用 FreeBSD 6 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD7
```

启用 FreeBSD 7 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD8
```

启用 FreeBSD 8 兼容性系统调用。


```ini
options 	COMPAT_FREEBSD9
```

启用 FreeBSD 9 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD10
```

启用 FreeBSD 10 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD11
```

启用 FreeBSD 11 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD12
```

启用 FreeBSD 12 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD13
```

启用 FreeBSD 13 兼容性系统调用。

```ini
options 	COMPAT_FREEBSD14
```

启用 FreeBSD 14 兼容性系统调用。

```ini
options 	COMPAT_LINUXKPI
```

启用 Linux 内核编程接口。


```ini
options 	SYSVSHM
options 	SYSVSEM
options 	SYSVMSG
```

* `SYSVSHM`：启用 System V 风格的共享内存支持。
* `SYSVSEM`：启用 System V 风格的信号量支持。
* `SYSVMSG`：启用 System V 风格的消息队列支持。


### 调试

```ini
options 	KDB
```

编译时包含内核调试器相关代码。

```ini
options 	KDB_TRACE
```

在系统发生 panic 时，在控制台打印当前线程的调用栈跟踪。

```ini
options 	KDB_UNATTENDED
```

在发生 panic 时不进入调试器。适用于无人值守的操作环境，你可能想通过控制台手动进入调试器，但仍希望系统能够在 panic 后自行恢复。


```ini
options 	DDB
```

启用 ddb 调试器后端。

```ini
options 	DDB_NUMSYM
```

除了符号表示外，还打印符号的数值。

```ini
options 	GDB
```

启用远程 gdb 调试器后端。

```ini
options 	QUEUE_MACRO_DEBUG_TRASH
```

在列表指针变为无效时（即元素从列表中移除）将其清空。启用成本相对较低。
 
```ini
#options 	QUEUE_MACRO_DEBUG_TRACE
```

在列表对象中存储最后一个修改列表对象的调用者的信息。需要额外的内存开销。

```ini
options 	SYSCTL_DEBUG
```

SYSCTL_DEBUG 启用将启用一 sysctl 调试树，可用于在控制台上转储已注册 sysctl 节点的内容。因为它会生成过于冗长的控制台输出，可能干扰串行控制台操作，所以默认情况下禁用。

```ini
options 	TEXTDUMP_PREFERRED
```

默认启用 textdump，将禁用内核核心转储。

```ini
options 	TEXTDUMP_VERBOSE
```

在执行 textdump 时启用额外的调试信息。

```ini
options 	NO_SYSCTL_DESCR
```

`NO_SYSCTL_DESCR` 会省略 sysctl 节点描述，以节省生成内核的空间。

```ini
options 	MALLOC_DEBUG_MAXZONES=8
```

`MALLOC_DEBUG_MAXZONES` 可为小于一页的 [malloc(9)](https://man.freebsd.org/malloc(9)) 分配启用多个 uma 区域。其目的是将不同的 malloc 类型隔离到哈希类别中，这样所有缓冲区溢出和释放后使用（UAF）问题通常只会影响该哈希类别中的 malloc 类型的内存。这纯粹是一款调试工具；通过改变哈希函数并追踪哪个哈希类别被破坏，每个实例的哈希类别交集将指向被滥用的单个 malloc 类型。此时可以使用检查或 [memguard(9)](https://man.freebsd.org/cgi/man.cgi?query=memguard&sektion=9&format=html) 来捕获问题代码。


```ini
options 	DEBUG_MEMGUARD
```

`DEBUG_MEMGUARD` 构建并启用 [memguard(9)](https://man.freebsd.org/cgi/man.cgi?query=memguard&sektion=9&format=html)，这是内核的替代分配器，用于检测释放后修改（modify-after-free）场景。有关使用的更多信息，请参见 [memguard(9)](https://man.freebsd.org/cgi/man.cgi?query=memguard&sektion=9&format=html) 手册页。

```ini
options 	DEBUG_REDZONE
```

`DEBUG_REDZONE` 为 [malloc(9)](https://man.freebsd.org/malloc(9)) 启用缓冲区下溢和缓冲区上溢的检测。

```ini
#options 	EARLY_PRINTF
```

`EARLY_PRINTF` 可在内核非常早期（在调用 `cn_init()` 之前）使用一种特殊的 `printf`（`eprintf`）。这通常仅用于启动早期调试。通常情况下，它未被定义。这里被注释掉是因为该功能通常不可用，而且所需的 `eputc()` 也未定义。

```ini
options 	KTRACE			# 内核跟踪
options 	KTRACE_REQUEST_POOL=101
```

`KTRACE` 启用系统调用跟踪功能 [ktrace(2)](https://man.freebsd.org/ktrace(2))。为了更好地支持 SMP，KTRACE 使用一个工作线程来异步处理大多数跟踪事件，而不是由生成事件的线程直接处理。这需要预先分配一个用于存储跟踪事件对象的池。选项`KTRACE_REQUEST_POOL` 指定该池的初始大小。可以在启动时/运行时通过可调参数和 sysctl `kern.ktrace_request_pool`  调整该池的大小。


```ini
options 	KTR
options 	KTR_BOOT_ENTRIES=1024
options 	KTR_ENTRIES=(128*1024)
options 	KTR_COMPILE=(KTR_ALL)
options 	KTR_MASK=KTR_INTR
options 	KTR_CPUMASK=0x3
options 	KTR_VERBOSE
```

KTR 是一款从 BSD/OS 引入的内核跟踪设施。通过选项 `KTR` 启用。

* `KTR_ENTRIES` 定义了循环跟踪缓冲区中的条目数量，可以是任意数字。
* `KTR_BOOT_ENTRIES` 定义了早期启动期间的条目数量，在 [malloc(9)](https://man.freebsd.org/malloc(9)) 可用之前使用。
* `KTR_COMPILE` 定义了要编译到内核中的事件掩码，由 `<sys/ktr.h>` 中的常量 `KTR_*` 定义。
* `KTR_MASK` 定义了变量 `ktr_mask` 的初始值，该变量在运行时决定要跟踪哪些事件。
* `KTR_CPUMASK` 决定哪些 CPU 记录事件，位 X 对应 CPU X。作为 KTR_CPUMASK 传入的字符串布局必须匹配一系列位掩码，每个掩码用 `,` 分隔（例如：`KTR_CPUMASK=0xAF,0xFFFFFFFFFFFFFFFF`）。
* `KTR_VERBOSE` 默认启用将 KTR 事件输出到控制台。此功能可以通过 sysctl `debug.ktr_verbose` 调整，如果未定义 `KTR_VERBOSE`，则默认关闭。

详情请参见 [ktr(4)](https://man.freebsd.org/cgi/man.cgi?query=ktr&sektion=4) 和 [ktrdump(8)](https://man.freebsd.org/cgi/man.cgi?query=ktrdump&sektion=8&format=html)。


```ini
options 	ALQ
options 	KTR_ALQ
```

- [ALQ(9)](https://man.freebsd.org/cgi/man.cgi?query=alq&sektion=9) 是一款用于将内核记录异步排队到 vnode 的机制。
- [ktr(4)](https://man.freebsd.org/cgi/man.cgi?query=ktr&sektion=4) 等服务使用它根据内核事件流生成跟踪文件。记录由工作线程异步写入。


```ini
options 	INVARIANTS
```

选项 `INVARIANTS` 在多个源文件中用于启用对内部结构的额外完整性检查。在默认情况下禁用，因为检查这些条件会额外消耗时间，而这些问题通常仅由编程错误引起。

```ini
options 	INVARIANT_SUPPORT
```

选项 `INVARIANT_SUPPORT` 能让我们在编译时加入对部分内部结构的验证支持。`INVARIANT_SUPPORT` 是启用 `INVARIANTS` 的前提，因为启用 `INVARIANTS` 会调用这些函数。其目的是，如果启用了 `INVARIANT_SUPPORT`，你可以为单个源文件设置 `INVARIANTS`（通过修改源文件或在命令行指定）。此外，如果你希望构建带有 `INVARIANTS` 的内核模块，将 `INVARIANT_SUPPORT` 添加到内核中可以提供所有必要的基础设施，且不会增加额外开销。


```ini
options 	KASSERT_PANIC_OPTIONAL
```

选项 `KASSERT_PANIC_OPTIONAL` 能在 kasserts 被触发时不一定引起 panic。panic 是默认行为，但运行时选项可以将其完全关闭，或者在设定限制下关闭。


```ini
options 	DIAGNOSTIC
```

选项 `DIAGNOSTIC` 用于启用额外的调试信息和完整性检查。由于这些额外检查对 `INVARIANTS` 内核来说开销过大或过于冗杂，因此默认情况下禁用。通常，配置了 `DIAGNOSTIC` 的内核也会启用 `INVARIANTS` 选项。

```ini
options 	REGRESSION
```

`REGRESSION` 将启用仅在回归测试中需要的可选内核接口。启用这些接口可能构成安全风险，因为它们允许进程轻松修改运行时环境的某些方面，会重现不太可能或异常（可能通常不可能出现）的场景。

```ini
options 	COMPILING_LINT
```

此选项能让某些在运行系统中无法共存的驱动程序共存。它用于能够一次性编译所有内核代码以进行质量保证（例如本文件，其名称即来源于该选项）。

```ini
options 	STACK
```

STACK 将启用 [stack(9)](https://man.freebsd.org/cgi/man.cgi?query=stack&sektion=9) 功能，可捕获内核栈。若内核编译中包含 [DDB(4)](https://man.freebsd.org/cgi/man.cgi?ddb(4))，[stack(9)](https://man.freebsd.org/cgi/man.cgi?query=stack&sektion=9) 也会被自动编译进内核。

```ini
options 	NUM_CORE_FILES=5
```

选项 `NUM_CORE_FILES` 指定了特定进程生成核心文件的数量上限，当核心文件格式说明符包含 `%I` 模式时。由于格式字符串中核心计数只有 `1` 个字符，可表示的范围为 0-9，因此该选项允许的最大值为 `10`。该核心文件数量限制可在运行时通过 sysctl `debug.ncores` 进行调整。

```ini
options 	TSLOG
options 	TSLOGSIZE=262144
```

`TSLOG` 选项可启用事件的时间戳记录，特别是函数的进/出，以便跟踪内核消耗的时间。尤其在早期启动过程中非常有用，因为此时还无法使用 DTrace 等更高级的工具。

* `TSLOGSIZE` 选项控制用于存储这些事件的（预分配、固定长度）缓冲区大小（默认：`262144` 条记录）。
* `TSLOG_PAGEZERO` 选项可启用对 `pmap_zero_page` 的 TSLOG；由于它通常会生成过多记录而不太实用，因此必须单独启用。

出于安全考虑，TSLOG 不应在用于生产的系统上启用。


### 性能监控

```ini
device		hwpmc			# 驱动程序（也可作为可加载模块）
options 	HWPMC_DEBUG
options 	HWPMC_HOOKS		# 其他必要的内核钩子
```

驱动程序 `hwpmc` 可使用 CPU 内置的性能监控计数器进行性能监控。基础内核需要通过 `options` 条目进行配置，可将 hwpmc 设备编译进内核或作为可加载内核模块来加载。

在特定架构上可能需要额外的配置选项，请参见 [hwpmc(4)](https://man.freebsd.org/hwpmc(4))。


### 网络接口

#### 协议栈

```
options 	INET			# 互联网通信协议（IPv4）
options 	INET6			# 互联网通信协议（IPv6）
```

```ini
options 	CC_CDG # CAIA Delay‑Gradient 算法
options 	CC_CHD # CAIA Hamilton‑Delay 算法
options 	CC_CUBIC # Cubic 算法
options 	CC_DCTCP # DCTCP 算法
options 	CC_HD # Hamilton Delay 算法
options 	CC_HTCP # H‑TCP 算法
options 	CC_NEWRENO # NewReno 算法
options 	CC_VEGAS # Vegas 算法
options 	CC_DEFAULT=\"cubic\" # 将 Cubic 指定为默认的拥塞控制算法
options 	RATELIMIT		# 传输速率限制支持

options 	ROUTETABLES=2		# 分配的 FIB 最多可达 65536。默认值为 1，但这不是个好主意，因为它们占用空间很大

options 	TCP_OFFLOAD		# TCP 卸载（offload）
options  	TCP_RFC7413		# TCP 快速打开（TCP Fast Open）

options  	TCPHPTS # 在启动时将 TCP 堆栈作为模块加载
#options 	TCP_HPTS_KTEST		# 为 HPTS 添加 KTEST 支持
```

>**注意**
>
>如果你使用了选项 `INET`、`INET6` 或同时指定了两者，**必须**至少指定一个拥塞控制选项，否则将编译失败。`GENERIC` 定义了 `CC_CUBIC`。如果编译了多款拥塞控制，你可能需要指定一个默认值。

`default` 中的字符串是 `cc` 模块的名称，在 sysctl 中用于设置默认值。代码将 `CUBIC` 定义为默认值，或者如果只编译了一个 `cc_module`，则使用该模块。

```ini
options 	IPSEC			# IPsec（需要设备加密支持）
```

IPsec（IP 安全）。要启用 `IPSEC`，**必须**在内核配置中同时指定设备加密支持。

```ini
options 	IPSEC_SUPPORT
#options 	IPSEC_DEBUG		# IPsec 调试
```

`IPSEC_SUPPORT` 选项并不会直接启用 IPsec，但它能将 IPsec 作为内核模块加载。你仍然 **必须** 在内核配置中添加设备加密支持。

```ini
options 	TCP_BBR # BBR（Bottleneck Bandwidth and Round-trip propagation time）
options 	TCP_RACK # RACK 栈，Recent ACKnowledgment
```

可选的 TCP 堆栈。


```ini
options 	KERN_TLS		# TLS 发送与接收卸载
```

TLS 用于通过 TCP 套接字对数据进行帧封装以及加/解密。

```ini
options 	NETLINK
```

Netlink 内核/用户 <-> 内核/用户 消息传递接口

```ini
options 	NETSMB			# SMB/CIFS 请求器（requester）
```

SMB/CIFS 请求器。NETSMB 启用了对 SMB 协议的支持，它需要选项 `LIBMCHAIN` 和 `LIBICONV`。

```ini
options 	LIBMCHAIN
```

mchain 库。它可以作为 KLD（可加载内核模块）加载，也可以编译进内核。

```ini
options 	LIBALIAS
```

libalias 库，用于执行 NAT（网络地址转换）。

```ini
options 	SCTP
options 	SCTP_SUPPORT
```

SCTP 是一种新型传输协议，由 RFC2960 定义，并由 RFC3309 和 RFC3758 更新，很快还会有新的基础 RFC 和更多扩展。本版本支持所有扩展，包括许多草案（大部分即将成为 RFC）。它是 SCTP 的参考实现，经过了充分测试。

>**注意**
>
>**必须同时定义 INET 和 INET6**。不必启用 IPv6，但 SCTP 是双栈协议，目前我们还没有拆分 IPv6 和 IPv4，因为一个关联（association）可以同时跨越 IPv6 和 IPv4 地址。

选项 `SCTP_SUPPORT` 并不会直接启用 SCTP，而是提供将 SCTP 作为可加载内核模块加载所需的支持。

```ini
options 	SCTP_DEBUG
```

有很多选项：

这个选项可开启各种详细打印功能。它由一个位掩码控制（可以通过 socket 选项和 sysctl 设置）。包含该选项本身不会立即产生日志，必须先设置相应的位。但打印信息可能非常冗长。因此，若未启用该选项，代码就不会进行位检测和打印，这样可以提高运行速度。如果你不是在调试，请不要使用。

```ini
options 	SCTP_LOCK_LOGGING
options 	SCTP_MBUF_LOGGING
options 	SCTP_MBCNT_LOGGING
options 	SCTP_PACKET_LOGGING
options 	SCTP_LTRACE_CHUNKS
options 	SCTP_LTRACE_ERRORS
```

上面的所有选项用于开启特定类型的日志记录。你可以监控拥塞窗口（CWND）增长、飞行数据量（flight size）以及各种其他指标。可以查看代码了解更多。我曾用这些日志生成过有趣的图表和曲线 :->

我还没有提交获取和打印日志的工具，但最终会完成。在那之前，如果你需要日志，可以发邮件给我 [rrs@freebsd.org](mailto:rrs@freebsd.org)。

基本上，你必须启用 [ktr(4)](https://man.freebsd.org/cgi/man.cgi?query=ktr&sektion=4) 来使用这些功能，然后通过 sysctl 设置打开或关闭各种日志位。使用 [ktrdump(8)](https://man.freebsd.org/cgi/man.cgi?query=ktrdump&sektion=8&format=html) 提取日志，再通过显示程序处理，就能生成图表等可视化内容。

```ini
options 	OFED
options 	OFED_DEBUG_INIT
```

OpenFabrics 企业版分发（InfiniBand）。

```ini
options 	SDP
options 	SDP_DEBUG
```

套接字直接协议（SDP）。


```ini
options 	IPOIB # Infiniband 协议栈及其支持
options 	IPOIB_DEBUG
options 	IPOIB_CM # 使用连接模式（connected mode）的 IPoIB
```

IP over Infiniband (IPoIB)，基于 InfiniBand 的互联网协议，参见 [wiki/Infiniband](https://wiki.freebsd.org/InfiniBand)。

```ini
options 	ALTQ # 交错队列，Alternate Queuing
options 	ALTQ_CBQ	# 基于类的排队
options 	ALTQ_RED	# 随机早期检测
options 	ALTQ_RIO	# RED 输入/输出
options 	ALTQ_CODEL	# CoDel 主动队列管理
options 	ALTQ_HFSC	# 分层服务曲线调度器
options 	ALTQ_FAIRQ	# 公平包调度器
options 	ALTQ_CDNR	# 流量调节器
options 	ALTQ_PRIQ	# 优先级队列
options 	ALTQ_NOPCC	# TSC 不可用时则必需
options 	ALTQ_DEBUG	# 启用 ALTQ 调试
```

[altq(9)](https://man.freebsd.org/cgi/man.cgi?query=altq&sektion=9)。通过选项 `ALTQ` 启用钩子的基础部分。各个调度策略必须编译进基本系统，不能在此阶段作为模块加载。ALTQ 需要稳定的 TSC，如果你的 TSC 不稳定或在 CPU 节流时发生变化，则必须同时启用选项 `ALTQ_NOPCC`。

```ini
options 	NETGRAPH		# netgraph(4) 系统 ①
options 	NETGRAPH_DEBUG		# 启用额外调试，这会影响 netgraph(4) 及其节点。
```

- ①：[netgraph(4)](https://man.freebsd.org/cgi/man.cgi?netgraph(4)) 系统，是一款网络工具包。使用选项 `NETGRAPH` 启用 netgraph 核心代码。

可以通过下列对应的选项启用各个节点类型；不过这并非严格必要，因为如果节点类型尚未编译进内核，netgraph 会自动加载对应的 KLD 模块。下面的每种类型都有对应的手册页，例如 [ng_async(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_async&apropos=0&sektion=4)。

```ini
options 	NETGRAPH_ASYNC # ng_async(4)
options 	NETGRAPH_BLUETOOTH		# ng_bluetooth(4)
options 	NETGRAPH_BLUETOOTH_HCI		# ng_hci(4)
options 	NETGRAPH_BLUETOOTH_L2CAP	# ng_l2cap(4)
options 	NETGRAPH_BLUETOOTH_SOCKET	# ng_btsocket(4)
options 	NETGRAPH_BLUETOOTH_UBT		# ng_ubt(4)
options 	NETGRAPH_BLUETOOTH_UBTBCMFW	# ubtbcmfw(4)
options 	NETGRAPH_BPF # ng_bpf(4)
options 	NETGRAPH_BRIDGE # ng_bridge(4)
options 	NETGRAPH_CAR # ng_car(4)
options 	NETGRAPH_CHECKSUM # ng_checksum(4)
options 	NETGRAPH_CISCO # ng_cisco(4)
options 	NETGRAPH_DEFLATE # [ng_deflate(4)
options 	NETGRAPH_DEVICE # ng_device(4)
options 	NETGRAPH_ECHO # ng_echo(4)
options 	NETGRAPH_EIFACE # ng_eiface(4)
options 	NETGRAPH_ETHER # ng_ether(4)
options 	NETGRAPH_FRAME_RELAY # ng_frame_relay(4)
options 	NETGRAPH_GIF # ng_gif(4)]
options 	NETGRAPH_GIF_DEMUX # ng_gif_demux(4)
options 	NETGRAPH_HOLE # ng_hole(4)
options 	NETGRAPH_IFACE # ng_iface(4)
options 	NETGRAPH_IP_INPUT # ng_ip_input(4)
options 	NETGRAPH_IPFW # ng_ipfw(4)
options 	NETGRAPH_KSOCKET # ng_ksocket(4)
options 	NETGRAPH_L2TP # ng_l2tp(4)
options 	NETGRAPH_LMI # ng_lmi(4)
options 	NETGRAPH_MPPC_COMPRESSION # ng_mppc(4)
options 	NETGRAPH_MPPC_ENCRYPTION # ng_mppc(4)
options 	NETGRAPH_NETFLOW # ng_netflow(4)
options 	NETGRAPH_NAT # ng_nat(4)
options 	NETGRAPH_ONE2MANY # ng_one2many(4)
options 	NETGRAPH_PATCH # ng_patch(4)
options 	NETGRAPH_PIPE # ng_pipe(4)
options 	NETGRAPH_PPP # ng_ppp(4)
options 	NETGRAPH_PPPOE # ng_pppoe(4)
options 	NETGRAPH_PPTPGRE # ng_pptpgre(4)
options 	NETGRAPH_PRED1 # ng_pred1(4)
options 	NETGRAPH_RFC1490 # ng_rfc1490(4)
options 	NETGRAPH_SOCKET # ng_socket(4)
options 	NETGRAPH_SPLIT # ng_split(4)
options 	NETGRAPH_TAG # ng_tag(4)
options 	NETGRAPH_TCPMSS # ng_tcpmss(4)
options 	NETGRAPH_TEE # ng_tee(4)
options 	NETGRAPH_UI # ng_UI(4)
options 	NETGRAPH_VJC # ng_vjc(4)
options 	NETGRAPH_VLAN # ng_vlan(4)
```

netgraph 节点类型：

* NETGRAPH_ASYNC —— [ng_async(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_async&apropos=0&sektion=4)
* NETGRAPH_BLUETOOTH —— [ng_bluetooth(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_bluetooth%284%29&apropos=0&sektion=4)
* NETGRAPH_BLUETOOTH_HCI —— [ng_hci(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_hci%284%29&apropos=0&sektion=4)
* NETGRAPH_BLUETOOTH_L2CAP —— [ng_l2cap(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_l2cap%284%29&apropos=0&sektion=4)
* NETGRAPH_BLUETOOTH_SOCKET —— [ng_btsocket(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_btsocket%284%29&apropos=0&sektion=4)
* NETGRAPH_BLUETOOTH_UBT —— [ng_ubt(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_ubt%284%29&apropos=0&sektion=4)
* NETGRAPH_BLUETOOTH_UBTBCMFW —— [ubtbcmfw(4)](https://man.freebsd.org/cgi/man.cgi?query=ubtbcmfw%284%29&apropos=0&sektion=4)
* NETGRAPH_BPF —— [ng_bpf(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_bpf&sektion=4)
* NETGRAPH_BRIDGE —— [ng_bridge(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_bridge&sektion=4&format=html)
* NETGRAPH_CAR —— [ng_car(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_car&sektion=4)
* NETGRAPH_CHECKSUM —— [ng_checksum(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_checksum&sektion=4)
* NETGRAPH_CISCO —— [ng_cisco(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_cisco&sektion=4)
* NETGRAPH_DEFLATE —— [ng_deflate(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_deflate&sektion=4)
* NETGRAPH_DEVICE —— [ng_device(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_device&sektion=4)
* NETGRAPH_ECHO —— [ng_echo(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_echo&sektion=4)
* NETGRAPH_EIFACE —— [ng_eiface(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_eiface&sektion=4)
* NETGRAPH_ETHER —— [ng_ether(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_ether&sektion=4)
* NETGRAPH_FRAME_RELAY —— [ng_frame_relay(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_frame_relay&sektion=4)
* NETGRAPH_GIF —— [ng_gif(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_gif&sektion=4)
* NETGRAPH_GIF_DEMUX —— [ng_gif_demux(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_gif_demux&sektion=4)
* NETGRAPH_HOLE —— [ng_hole(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_hole&sektion=4)
* NETGRAPH_IFACE —— [ng_iface(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_iface&sektion=4)
* NETGRAPH_IP_INPUT —— [ng_ip_input(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_ip_input&sektion=4)
* NETGRAPH_IPFW —— [ng_ipfw(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_ipfw&sektion=4)
* NETGRAPH_KSOCKET —— [ng_ksocket(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_ksocket&sektion=4)
* NETGRAPH_L2TP —— [ng_l2tp(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_l2tp&sektion=4)
* NETGRAPH_LMI —— [ng_lmi(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_lmi&sektion=4)
* NETGRAPH_MPPC_COMPRESSION —— [ng_mppc(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_mppc&sektion=4)
* NETGRAPH_MPPC_ENCRYPTION —— [ng_mppc(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_mppc&sektion=4)
* NETGRAPH_NETFLOW —— [ng_netflow(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_netflow&sektion=4)
* NETGRAPH_NAT —— [ng_nat(4)](https://man.freebsd.org/ng_nat(4))
* NETGRAPH_ONE2MANY —— [ng_one2many(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_one2many)
* NETGRAPH_PATCH —— [ng_patch(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_patch&sektion=4)
* NETGRAPH_PIPE —— [ng_pipe(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_pipe&apropos=0&sektion=0)
* NETGRAPH_PPP —— [ng_ppp(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_ppp&sektion=4)
* NETGRAPH_PPPOE —— [ng_pppoe(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_pppoe)
* NETGRAPH_PPTPGRE —— [ng_pptpgre(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_pptpgre&sektion=4)
* NETGRAPH_PRED1 —— [ng_pred1(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_pred1&sektion=4)
* NETGRAPH_RFC1490 —— [ng_rfc1490(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_rfc1490&sektion=4)
* NETGRAPH_SOCKET —— [ng_socket(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_socket&sektion=4)
* NETGRAPH_SPLIT —— [ng_split(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_split&sektion=4)
* NETGRAPH_TAG —— [ng_tag(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_tag)
* NETGRAPH_TCPMSS —— [ng_tcpmss(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_tcpmss&sektion=4)
* NETGRAPH_TEE —— [ng_tee(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_tee)
* NETGRAPH_UI —— [ng_UI(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_UI&sektion=4)
* NETGRAPH_VJC —— [ng_vjc(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_vjc&sektion=4)
* NETGRAPH_VLAN —— [ng_vlan(4)](https://man.freebsd.org/cgi/man.cgi?query=ng_vlan)

```ini
options 	VIMAGE
options 	VNET_DEBUG	# VIMAGE 调试用
```

[vimage(9)](https://man.freebsd.org/cgi/man.cgi?query=vimage&sektion=9)（即 VNET(9) 的别名），用于网络栈虚拟化。

#### 网络接口

```ini
device		loop
```

当启用网络功能时，[loop(4)](https://man.freebsd.org/cgi/man.cgi?query=loop&apropos=0&sektion=4) 设备是 **必需的**。

```ini
device		ether
```

`ether` 设备提供了用于处理以太网的通用代码；当需要配置以太网设备驱动时，它是 **必需的**。

```ini
device		vlan
```

[vlan(4)](https://man.freebsd.org/cgi/man.cgi?query=vlan&apropos=0&sektion=4) 设备可根据 IEEE 802.1Q 实现以太网帧的 VLAN 标记。

```ini
device		vxlan
```

[vxlan(4)](https://man.freebsd.org/cgi/man.cgi?query=vxlan&apropos=0&sektion=4) 设备将根据 RFC7348 实现以太网帧在 UDP 数据包中的 VXLAN 封装。

```ini
device		wlan
options 	IEEE80211_DEBUG		# 启用调试信息
options 	IEEE80211_DEBUG_REFCNT
options 	IEEE80211_SUPPORT_MESH	# 启用 802.11s D3.0
options 	IEEE80211_SUPPORT_TDMA	# 启用 TDMA 
```

[wlan(4)](https://man.freebsd.org/cgi/man.cgi?query=wlan&apropos=0&sektion=4) 设备提供了支持 802.11 驱动的通用代码，包括主机 AP 模式；对于 wi 和 ath 驱动来说，`wlan` 是 **必需的**，并且最终将成为所有 802.11 驱动的必需项。



