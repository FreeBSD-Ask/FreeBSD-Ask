# 第 15.1 节 网络参数配置命令

## `/etc/rc.conf` 相关

`/etc/rc.conf`：

```ini
hostname="ykla" # 主机名，不能为空，否则无法使用 xorg
ifconfig_igc0="DHCP" # 让网卡 igc0 使用 DHCP
ifconfig_igc0="inet 192.168.31.77  netmask 255.255.255.0" # 设置网卡 igc0 的 IPv4 为 192.168.31.77，子网掩码为 255.255.255.0（静态 IP）
defaultrouter="192.168.31.1" # 默认网关/默认路由，一般是路由 IP
ifconfig_igc0_alias0="inet 192.168.1.33 netmask 255.255.255.0" # 设置网卡 igc0 别名 IPv4 192.168.1.33，子网掩码为 255.255.255.0。即拥有额外的 IPv4 地址
static_routes="static1 static2" # 静态路由，结合下方使用①
route_static1="-net 10.0.10.0/24 10.0.1.1" # 如果要访问 10.0.10.0/24 这个网络（10.0.10.0 到 10.0.10.254），就把数据包发送给 10.0.1.1，由它来转发
route_static2="-net 172.16.30.0/24 172.16.1.254" # 如果要访问 172.16.30.0/24  这个网络（172.16.30.1 到 172.16.30.254），就把数据包发送给 172.16.1.254，由它来转发
```

①在 `/etc/rc.conf` 中如果要一次写多个配置，只能写成 `ABC_XYZ="xxx yyy ccc ddd"` 这种格式。

如果在 `/etc/rc.conf` 中写成

```ini
ABC_XYZ="xxx" # 第一行
ABC_XYZ="yyy"
ABC_XYZ="ccc"
ABC_XYZ="ddd"
```

这种形式，只有第一行会生效，其余 `ABC_XYZ` 配置行不会生效！

## 作为网关服务器

打开 IP 转发功能：

```sh
# sysrc gateway_enable="YES"
# sysrc ipv6_gateway_enable="YES"
```

打开防火墙，开启 NAT：

```sh
# sysrc firewall_enable="YES"
# sysrc firewall_script="/etc/ipfw.rules"
# sysrc firewall_nat_enable="YES"
```

设置默认接受连接： 

编辑 `/boot/loader.conf`，写入：

```sh
net.inet.ip.fw.default_to_accept=1
```

## 手动设置 `resolv.conf`

手动编辑 `/etc/resolv.conf` 后，重启系统又会被重置，因为 DHCP 会重写这个文件。

防止 `resolvconf` 服务覆盖 `resolv.conf`：

编辑 `/etc/resolvconf.conf`，写入 `resolvconf=NO `

### 参考文献

- [ 8.8.8.8 or 1.1.1.1 if set in etc resolv conf doesn't stay as an entry in the file after a network restart](https://forums.freebsd.org/threads/8-8-8-8-or-1-1-1-1-if-set-in-etc-resolv-conf-doesnt-stay-as-an-entry-in-the-file-after-a-network-restart.85951/)

## 查看网卡速率

每 2 秒刷新一次：

```sh
# systat -if 2
```

## 查看 FreeBSD 下载流量（net-mgmt/bwm-ng）

```sh
# pkg install bwm-ng
# bwm-ng
  bwm-ng v0.6.3 (probing every 0.500s), press 'h' for help
  input: getifaddrs type: rate
  /         iface                   Rx                   Tx                Total
  ==============================================================================
              em0:           2.04 MB/s            6.03 KB/s            2.05 MB/s
              lo0:           0.00  B/s            0.00  B/s            0.00  B/s
        vm-public:           2.04 MB/s            2.05 MB/s            4.09 MB/s
             tap0:           5.49 KB/s            2.04 MB/s            2.04 MB/s
  ------------------------------------------------------------------------------
            total:           4.09 MB/s            4.09 MB/s            8.18 MB/s
```

按字母 `d` 可以切换流量格式。按 `h` 可以查阅更多使用方法。
