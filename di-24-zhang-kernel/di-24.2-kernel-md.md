# 24.2 机器相关的内核选项

原文：[amd64/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/amd64/conf/NOTES)，版本 [mpi3mr: Broadcom's MPT-Fusion version 4 is amd64 and aarch64 only](https://github.com/freebsd/freebsd-src/commit/2f721943bf20e53b0ba7b5032a2900d0beb67413)。

>**技巧**
>
>可直接剪切/粘贴内核和 hints 条目到内核配置文件中。

## amd64 机器相关的内核选项

### GCOV (生成覆盖率信息)

```sh
options 	LINDEBUGFS # ①
options 	GCOV # ②
```

- ① 用于调试的 Linux 文件系统，参见 [lindebugfs(5)](https://man.freebsd.org/cgi/man.cgi?query=lindebugfs&sektion=5)
- ② GCOV 实际上是 llvm-cov，参见 [gcov(1)](https://man.freebsd.org/cgi/man.cgi?query=gcov&sektion=1)


### SMP

可选设备：

```sh
device		atpic			# 可选兼容 pic 可编程中断控制器，ISA 相关
device		mptable			# 可选的 MPSPEC 多处理器表 ①
```

- ①：显示多处理器配置表，参见 [mptable(1)](https://man.freebsd.org/cgi/man.cgi?query=mptable&sektion=1)

### CPU

>**技巧**
>
>你必须至少指定一款 CPU（即你打算运行的那款 CPU）；删除那些你不打算使用的 CPU 的配置可能会让系统中的某些部分运行得更快。

```sh
cpu		HAMMER			# HAMMER 是 AMD K8 研发代号，即 Opteron（皓龙）& Athlon64（速龙）
```

### 硬件设备配置

可选设备：

```sh
device		vt_efifb	# EFI framebuffer（帧缓冲）①
```

- ① vt(4) 驱动。参见 [vt(4)](https://man.freebsd.org/cgi/man.cgi?query=vt%284%29&apropos=0&sektion=4)


```sh
device		tdfx			# 启用 3Dfx Voodoo
```

3Dfx Voodoo Graphics、Voodoo II 的 /dev/3dfx 字符设备支持（1990 年代的产品）。将创建设备 `/dev/3dfx0` ，以便与 Glide 实现一起使用。该设备应链接到 `/dev/3dfx` 和 `/dev/voodoo`。请注意，这与 XFree86 的 tdfx DRI 模块不同，完全无关。


#### RAID 适配器

```sh
#device	pst
```

Promise Supertrak SX6000 的设备驱动程序

```sh
device		smartpqi
```

Microsemi smartpqi 控制器。这些控制器有类似 SCSI 的接口，并且需要 CAM 基础设施。


```sh
device		mpi3mr			# LSI-Logic MPT-Fusion 4
```

Broadcom MPT Fusion，第 4 版，仅支持 64 位。

#### 网络接口

```sh
device		axp	    # AMD EPYC 集成网卡，依赖 miibus 模块
device		ixl	    # Intel 700 Series Physical Function，依赖 ice_ddp 模块
device		iavf 	  # Intel Adaptive Virtual Function
device		ice		  # Intel 800 Series Physical Function
device		ice_ddp	# Intel 800 Series DDP Package
device		irdma		# Intel 800 Series RDMA 驱动，依赖 ice 模块
device		qlxgb		# QLogic 3200/8200 10Gb 以太网 & CNA 适配器
device		qlxgbe	# QLogic 8300 10Gb 以太网 & CNA 适配器
device		qlxge		# QLogic 8100 系列 10Gb 以太网 & CNA 适配器
device		qlnxe		# QLogic 41000/45000 以太网系列 10/25/40/100 GbE 以太网与 CNA 适配器
device		sfxge		# Solarflare SFC9000 系列 10Gb 以太网
```

#### 其他硬件

```sh
device		ioat		# Intel I/OAT DMA 引擎
```

Intel I/O 加速技术支持

```sh
options 	EFIRT
```

EFI 运行时服务支持

```sh
device		efidev
```

EFI 伪设备

```sh
device		efirtc
```

EFI RTC（实时时钟）

```sh
device		qat_c2xxx
```

带 OpenCrypto 支持的 Intel QuickAssist 驱动，仅支持 Atom C2XXX 芯片组。

```sh
options 	XENHVM		# Xen HVM 内核基础设施
device		xenefi		# Xen EFI 定时器驱动
device 		xenpci		# Xen HVM Hypervisor 服务驱动
device		xentimer	# Xen x86 PV 定时器驱动
```

Xen HVM 虚拟机优化。

### ABI 仿真

```sh
options 	COMPAT_FREEBSD32
```

启用 FreeBSD / i386 二进制文件的 32-bit 运行时支持。

```sh
options 	COMPAT_AOUT
```

启用 （32-bit） a.out 二进制文件支持。


### ZFS

>**注意**
>
>这取决于 crypto、cryptodev 和 ZSTDIO。

```sh
options 	ZFS
```

ZFS 文件系统。

### VM

```sh
options 	NKPT=31
```

用于早期引导的初始内核页表页数量。这个数量应包含足够的页，以映射内核以及加载器随内核加载的任何模块或其他数据。每个页表页映射 2 MB。

```sh
options 	KSTACK_PAGES=5
```

KSTACK_PAGES 是为每个线程的内核栈分配的内存页数量。


```sh
options 	PV_STATS
```

启用 PV entry 分配器的详细记账功能。

### 内核清理器（sanitizers）

```sh
#options	COVERAGE	# 通用内核覆盖率。KCOV 会依赖此选项
#options	KCOV			# 内核覆盖率清理器
#options	KUBSAN		# 内核未定义行为清理器 ①
#options	KCSAN			# 内核并发清理器
#options	KASAN			# 内核地址清理器
#options	KMSAN			# 内核内存清理器
```

- ① 警告：KUBSAN 可能会导致内核过大，以至于 loader 无法加载。

## i386 和 amd64 共用的机器相关内核选项

原文 [x86/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/x86/conf/NOTES)，版本 [NOTES: Add iwm and iwx](https://github.com/freebsd/freebsd-src/commit/b1039bbe185bbadea24207b600f4bea065a2dbee)。

>**技巧**
>
>可直接剪切/粘贴内核和 hints 条目到内核配置文件中。


### DTrace

```sh
#options 	KDTRACE_HOOKS
```

启用内核 DTrace hooks，DTrace 模块依赖此选项。

```sh
#device		dtrace
```

DTrace 核心。

>**注意**
>
>这将会将 CDDL 许可下的组件（DTrace）引入内核。


```sh
#device		dtrace_profile
#device		dtrace_sdt
#device		dtrace_fbt
#device		dtrace_systrace
#device		dtrace_prototype
#device		dtnfscl
#device		dtmalloc
```

各种 DTrace 模块。

```sh
#device		dtraceall
```

可选项，加载以上所有 DTrace 模块。


### SMP

```sh
options 	IPI_PREEMPTION
```

可选项。

>**注意**
>
>`IPI_PREEMPTION` 指示内核在需要时抢占其他 CPU 上运行的线程。该功能依赖 `PREEMPTION`。

```sh
options 	COUNT_XINVLTLB_HITS	# TLB 事件计数器
options 	COUNT_IPIS		# 每 CPU IPI 中断计数器
```

调试选项。


### 兼容性


```sh
options 	COMPAT_43
```

实现与 4.3BSD、FreeBSD 1.x 及 2.x 的 a.out 二进制文件兼容的系统调用。ELF 二进制文件或更新的 a.out 二进制文件无需此功能。

### 网络支持

```sh
options 	DEVICE_POLLING
```

`DEVICE_POLLING` 为网络设备驱动程序添加了中断与轮询混合处理支持，该功能在应对过载的健壮性、系统响应性以及在内核网络处理与其他活动之间实现精确的 CPU 时间调度方面具有显著优势。其缺点在于响应时间可能适度增加（最多可达 1/HZ 秒）。

强烈建议在使用 DEVICE_POLLING 时将 HZ 设置为 1000 或 2000 以获得更平滑的运行表现。此外，你可以在运行时通过 ifconfig(8) 工具启用/禁用轮询功能，并通过 sysctl 变量 `kern.polling.user_frac`（默认值 50，范围 0 到 100）调整保留给用户空间的 CPU 时间比例。需要注意的是，在本文撰写时，并非所有设备驱动程序都支持此工作模式。更多详细信息请参阅 polling(4)。

```sh
options 	BPF_JITTER
```

`BPF_JITTER` 为 BPF 添加了即时编译器支持。


### 时钟

```sh
device		nvram		# 通过 /dev/nvram 访问 rtc cmos
```

提供对时钟芯片内存的读写访问。


### 其他杂项设备与选项

```sh
device		speaker	
envvar		hint.speaker.0.at="isa"
envvar		hint.speaker.0.port="0x61"
```

通过扬声器播放 IBM BASIC 风格的提示音。

#### 硬件总线配置

```sh
options 	IOMMU			
```

启用 IOMMU。

```sh
device		isa
```

启用 ISA 总线。

```sh
options 	AUTO_EOI_1
#options 	AUTO_EOI_2

options 	MAXMEM=(128*1024)
#options 	BROKEN_KEYBOARD_RESET
```

ISA 总线选项。

`AUTO_EOI_1` 为主 8259A 中断控制器启用“自动 EOI”功能。每次中断可节省约 0.7-1.25 微秒。此选项会破坏部分便携式设备的挂起/恢复功能。

`AUTO_EOI_2` 为从 8259A 中断控制器启用“自动 EOI”功能。每次中断可节省约 0.7-1.25 微秒。文档记载自动 EOI 在原始 i8259A 芯片的从控制器上无效，但部分克隆芯片和集成版本可正常使用。

`MAXMEM` 用于指定机器内存容量。若未指定该参数，FreeBSD 将首先从 CMOS RAM 读取内存容量，此时初始内存将被限制在 64MB 或 16MB（具体取决于 BIOS）。若 BIOS 报告 64MB，系统将通过内存探测尝试检测实际安装的内存容量。若探测失败且内存大于 64MB，则必须使用 `MAXMEM` 参数。容量值以千字节为单位，例如 128MB 内存需设置为 131072（128 * 1024）。

`BROKEN_KEYBOARD_RESET` 可禁用通过键盘控制器执行 CPU 复位重启的功能。此选项适用于键盘控制器存在故障的系统。

```sh
device		agp
```

AGP GART 支持。


```sh
options 	AGP_DEBUG
```

AGP 调试。

#### ACPI

```sh
device		acpi
options 	ACPI_DEBUG
```

ACPI 支持（基于英特尔 ACPI 组件架构参考实现）

`ACPI_DEBUG` 可通过内核环境变量 `debug.acpi.level` 与 `debug.acpi.layer` 来设置英特尔 ACPICA 代码的初始调试级别（注意：此功能需在英特尔代码编译时启用选项 `USE_DEBUGGER`）


```sh
device		acpi_wmi
```

ACPI WMI 映射驱动程序


```sh
device		acpi_asus
```

面向华硕的 ACPI 扩展功能（LCD 背光/亮度、视频输出等）

```sh
device		acpi_fujitsu
```

面向富士通的 ACPI 扩展功能（按键）

```sh
device		acpi_hp
```

面向惠普笔记本的 ACPI 扩展驱动

```sh
device		acpi_ibm
```

面向 IBM 笔记本（ThinkPad）的 ACPI 扩展驱动

```sh
device		acpi_panasonic
```

面向松下的 ACPI 扩展功能（LCD 背光/亮度、视频输出等）

```sh
device		acpi_sbl_wmi
```

ACPI SBL 固件更新

```sh
device		acpi_sony
```

面向索尼的 ACPI 扩展功能（LCD 亮度调节）

```sh
device		acpi_toshiba
```

面向东芝的 ACPI 扩展功能（LCD 背光/亮度、视频输出等）

```sh
device		acpi_video
```

ACPI 视频扩展功能（LCD 背光/亮度、视频输出等）

```sh
device		acpi_dock
```

ACPI 扩展坞支持

```sh
device		aibs
```

ACPI ASOC ATK0110 华硕 AI Booster（电压、温度与风扇传感器）

#### 硬件设备配置

##### 可选设备

```sh
device		sc
envvar		hint.sc.0.at="isa"
options 	MAXCONS=16		# 虚拟控制台数量
options 	SC_ALT_MOUSE_IMAGE	# 文本模式下的简化鼠标光标
options 	SC_DFLT_FONT		# 编译内置字体
makeoptions	SC_DFLT_FONT=cp850
options 	SC_DFLT_TERM=\"sc\"	# 默认的终端模拟器
options 	SC_DISABLE_KDBKEY	# 禁用 `debug' 调试键
options 	SC_DISABLE_REBOOT	# 禁用重启快捷键
options 	SC_HISTORY_SIZE=200	# 历史缓冲区行数
options 	SC_MOUSE_CHAR=0x3	# 文本模式鼠标光标字符代码
options 	SC_PIXEL_MODE		# 添加对光栅文本模式的支持
```

syscons 控制台驱动程序（兼容 SCO 彩色控制台）。

```sh
options 	SC_NORM_ATTR=(FG_GREEN|BG_BLACK)
options 	SC_NORM_REV_ATTR=(FG_YELLOW|BG_GREEN)
options 	SC_KERNEL_CONS_ATTR=(FG_RED|BG_BLACK)
options 	SC_KERNEL_CONS_ATTRS=\"\x0c\x0d\x0e\x0f\x02\x09\x0a\x0b\"
options 	SC_KERNEL_CONS_REV_ATTR=(FG_BLACK|BG_RED)
```

以上选项可用于调整 syscons 的默认颜色配置。

sc 的 `flags` 参数：

- `0x80` 将显卡设置为 VESA 800x600 点阵 16 色模式
- `0x100` 若未检测到键盘设备则进行周期性探测

```sh
options 	SC_CUT_SPACES2TABS	# 将前导空格转换为制表符
options 	SC_CUT_SEPCHARS=\"x09\"	# 单词分隔符字符集（默认为单个空格 - "x20"）
```

以上选项可用于修改剪切粘贴功能的默认行为。

```sh
options 	SC_TWOBUTTON_MOUSE
```

若使用双键鼠标，可添加以上选项来启用鼠标右键粘贴文本的功能。

```sh
options 	SC_NO_CUTPASTE
options 	SC_NO_FONT_LOADING
options 	SC_NO_HISTORY
options 	SC_NO_MODE_CHANGE
options 	SC_NO_SYSMOUSE
options 	SC_NO_SUSPEND_VTYSWITCH
#!options 	SC_NO_TERM_DUMB
#!options 	SC_NO_TERM_SC
#!options 	SC_NO_TERM_SCTEKEN
```

可选择性禁用 syscons 中的功能模块。

```sh
device		splash
```

启动画面与屏幕保护程序。


```sh
device		blank_saver
device		daemon_saver
device		dragon_saver
device		fade_saver
device		fire_saver
device		green_saver
device		logo_saver
device		rain_saver
device		snake_saver
device		star_saver
device		warp_saver
```

多种屏幕保护程序。

```sh
options 	VESA
```

VGA VESA 显示模式。

```sh
options 	VESA_DEBUG
```

启用针对 VESA 支持的额外调试检查与输出。

```sh
device		dpms		
```

通过 VESA BIOS 实现 DPMS（VESA 显示电源管理信号）挂起与恢复功能。

```sh
options 	X86BIOS
```

x86 实模式 BIOS 模拟器（atkbdc/dpms/vesa 功能依赖于此）。


```sh
device		psm
envvar		hint.psm.0.at="atkbdc"
envvar		hint.psm.0.irq="12"
```

PS/2 鼠标。


```sh
options 	PSM_HOOKRESUME		
```

psm 选项。

在系统恢复事件时重置设备（对部分笔记本电脑特别有用）。


```sh
device		atkbdc
envvar		hint.atkbdc.0.at="isa"
envvar		hint.atkbdc.0.port="0x060"
```

键盘控制器：该组件负责控制键盘与 PS/2 鼠标。

```sh
device		atkbd
envvar		hint.atkbd.0.at="atkbdc"
envvar		hint.atkbd.0.irq="1"
```

AT 键盘。


```sh
options 	ATKBD_DFLT_KEYMAP	# 指定内置键盘布局
makeoptions	ATKBD_DFLT_KEYMAP=fr.dvorak
```

atkbd 驱动选项。

atkbd 的 flags 参数：

- `0x01` 强制检测键盘（默认始终假设存在键盘）
- `0x02` 禁止重置键盘（适用于部分新型 ThinkPad）
- `0x03` 强制检测且避免重置（可能有助于特定扩展坞兼容性）
- `0x04` 启用旧式（XT）键盘支持（适用于旧款 ThinkPad）

```sh
device		vga
envvar		hint.vga.0.at="isa"
```

VGA 适配器显卡驱动程序

```sh
options 	VGA_ALT_SEQACCESS
```

vga 驱动选项：若鼠标指针显示异常或字体加载不正确，可尝试以上选项（可能在某些系统上引发屏幕闪烁）。

.

```sh
#options 	VGA_NO_FONT_LOADING	# 不保存/不加载字体
#options 	VGA_NO_MODE_CHANGE	# 不更改显示模式
```

若需节省内存空间，可通过以上选项禁用部分 vga 驱动程序功能。

```sh
options 	VGA_SLOW_IOACCESS	# 
```

对 TS 与 GDC 寄存器执行字节宽度 I/O 操作。较旧的显卡可能需要此选项以确保正常运行。

```sh
options 	VGA_WIDTH90
```

支持 90 列模式。以上选项可能不适用于 LCD 显示屏。

```sh
options 	VGA_DEBUG
```

调试器。

```sh
device		vt_vga		# VGA
device		vt_vbefb	# VBE framebuffer
```

vt(4) 驱动。

```sh
device		s3pci
```

基于 VESA 的 S3 VESA 1.2 显卡线性帧缓冲驱动程序


#### RAID 适配器

```sh
device		arcmsr		# Areca SATA II RAID
```

Areca 11xx 与 12xx 系列 SATA II RAID 控制器（需启用 CAM 子系统）。


```sh
device		aac
device		aacp	# SCSI 直通接口（可选功能，需启用 CAM 子系统）
```

Adaptec FSA RAID 控制器系列，包含戴尔集成控制器、戴尔 PERC 2/QC 及惠普 NetRAID-4M。

```sh
# Highpoint RocketRAID 27xx
device		hpt27xx

# Highpoint RocketRAID 182x
device		hptmv

# Highpoint DC7280 和 R750
device		hptnr

# Highpoint RocketRAID.  支持 RR172x, RR222x, RR2240, RR232x, RR2340, RR2210, RR174x, RR2522, RR231x, RR230x
device		hptrr

# Highpoint RocketRaid 3xxx 系列 SATA RAID
device		hptiop
```

Highpoint 相关设备。

```sh
device		ips
```

IBM (now Adaptec) ServeRAID 控制器


```sh
device		isci
options 	ISCI_LOGGING	# 在 isci HAL 中启用调试功能
```

英特尔 C600（Patsburg）集成 SAS 控制器

```sh
device		vmd
```

英特尔卷管理设备 (VMD) 支持。

```sh
device		pmspcv
```

PMC-Sierra SAS/SATA 控制器。

#### 软盘

```sh
device		fdc
envvar		hint.fdc.0.at="isa"
envvar		hint.fdc.0.port="0x3F0"
envvar		hint.fdc.0.irq="6"
envvar		hint.fdc.0.drq="2"
```

标准软盘控制器与软盘磁带驱动器，支持 Y-E DATA 外置 FDD（PC 卡）。

```sh
options 	FDC_DEBUG
```

FDC_DEBUG 可启用软盘调试功能。由于调试输出量极大，需通过 DDB 设置 fd_debug 变量方可激活。

```sh
#hint.fdc.0.flags="1"
```

若你使用 Insight 的软盘磁带设备，请激活此配置项。由于仅配置软盘的用户进行设备探测存在风险，此功能已通过标志位进行隔离保护。

```sh
envvar		hint.fd.0.at="fdc0"
envvar		hint.fd.0.drive="0"
envvar		hint.fd.1.at="fdc0"
envvar		hint.fd.1.drive="1"
```

指定软盘设备

#### CPU 频率控制

```sh
device		cpufreq
```

cpufreq(4) 驱动程序提供了对非 ACPI CPU 频率控制的支持。

#### 网卡

```sh
device		bxe		# 博通 NetXtreme II BCM5771X/BCM578XX 10GbE 以太网卡
device		gve		# 谷歌虚拟网卡 (gVNIC)
device		igc		# Intel I225 2.5G Ethernet
device		ipw		# Intel 2100 无线网卡（Intel PRO/Wireless 2100 IEEE 802.11 适配器），依赖 ipw 固件
device		iwi		# Intel 2200BG/2225BG/2915ABG 无线网卡（Intel PRO/Wireless 2200BG/2225BG/2915ABG IEEE 802.11 适配器），依赖 iwi 固件
device		iwm		# Intel IEEE 802.11ac 无线网卡（Intel Wireless WiFi Link 1000/105/135/2000/4965/5000/6000/6050 abgn 802.11 网络适配器），依赖 iwm 固件
device		iwn		# Intel 4965/1000/5000/6000 无线网卡
device		iwx		# Intel IEEE 802.11ax 无线网卡
device  	mthca		# Mellanox HCA InfiniBand
device  	mlx4		# InfiniBand 与以太网共用的代码模块
device  	mlx4ib		# Mellanox ConnectX HCA InfiniBand
device  	mlx4en		# Mellanox ConnectX HCA Ethernet
device		nfe		# 英伟达 nForce MCP 板载以太网（以 BSD 开源）
device		vmx		# VMware VMXNET3 以太网（以 BSD 开源）
device		wpi		# Intel 3945ABG 无线网卡（Intel 3945ABG 无线局域网控制器），依赖 wpi 固件
```

#### IEEE 802.11 适配器固件


```sh
device		iwifw
device		iwibssfw
device		iwiibssfw
device		iwimonitorfw
device		ipwfw
device		ipwbssfw
device		ipwibssfw
device		ipwmonitorfw
device		iwnfw
device		iwn1000fw
device		iwn105fw
device		iwn135fw
device		iwn2000fw
device		iwn2030fw
device		iwn4965fw
device		iwn5000fw
device		iwn5150fw
device		iwn6000fw
device		iwn6000g2afw
device		iwn6000g2bfw
device		iwn6050fw
device		wpifw
```

Intel PRO/Wireless 2100 固件：

- ipwfw - 支持 BSS/IBSS/监听模式的全功能固件
- ipwbssfw - 仅支持 BSS 模式固件
- ipwibssfw - 仅支持 IBSS 模式固件
- ipwmonitorfw - 仅支持监听模式固件

Intel PRO/Wireless 2200BG/2225BG/2915ABG 固件：

- iwifw - 支持 BSS/IBSS/监听模式的全功能固件
- iwibssfw - 仅支持 BSS 模式固件
- iwiibssfw - 仅支持 IBSS 模式固件
- iwimonitorfw - 仅支持监听模式固件

Intel Wireless WiFi Link 4965/1000/5000/6000 系列固件：

- iwnfw - 支持所有该系列设备的单一模块
- iwn1000fw - 仅适用于 1000 的特定模块
- iwn105fw - 仅适用于 105 的特定模块
- iwn135fw - 仅适用于 135 的特定模块
- iwn2000fw - 仅适用于 2000 的特定模块
- iwn2030fw - 仅适用于 2030 的特定模块
- iwn4965fw - 仅适用于 4965 的特定模块
- iwn5000fw - 仅适用于 5000 的特定模块
- iwn5150fw - 仅适用于 5150 的特定模块
- iwn6000fw - 仅适用于 6000 的特定模块
- iwn6000g2afw - 仅适用于 6000g2a 的特定模块
- iwn6000g2bfw - 仅适用于 6000g2b 的特定模块
- iwn6050fw - 仅适用于 6050 的特定模块

其他：

- wpifw - Intel 3945ABG 无线局域网控制器固件


#### 非透明桥 (NTB) 驱动程序

```sh
device		if_ntb		# 虚拟 NTB 网卡
device		ntb_transport	# NTB 数据包传输驱动程序
device		ntb		# NTB 硬件接口
device		ntb_hw_amd	# AMD NTB 硬件驱动
device		ntb_hw_intel	# Intel NTB 硬件驱动
device		ntb_hw_plx	# PLX NTB 硬件驱动
```

#### 其他硬件


```sh
device		ipmi    # 智能平台管理接口
device		pbio    # 并行（8255 PPI）基本 I/O（模式 0）端口（例如 Advantech PCL-724）
envvar		hint.pbio.0.at="isa"
envvar		hint.pbio.0.port="0x360"
device		smbios  # DMI/SMBIOS 入口点（需启用 EFIRT 选项）
device		vpd # 重要产品数据内核接口
device		asmc    # 苹果系统管理控制器
device		tpm # 可信平台模块
device		rdrand_rng	# 英特尔 Bull Mountain 随机数生成器
device		aesni		# AES-NI OpenCrypto 模块
device		ossl		# OpenSSL OpenCrypto 模块
```

Specialix SI/XIO 驱动程序注意事项：

- 主机卡采用内存映射（非 I/O 映射）
- Rev 1 主机卡使用 64K 内存块，对齐边界为 32K
- Rev 2 主机卡使用 32K 内存块，对齐边界为 32K
- 该系列卡支持使用 IRQ 11、12 或 15

```sh
device		kvm_clock	# KVM 半虚拟化时钟驱动程序
```

Linux KVM 半虚拟化支持。


```sh
device 		hyperv		# Hyper-V 驱动
device		hvhid		# Hyper-V HID 驱动
```

微软 Hyper-V 增强支持

```sh
device		pvscsi		# 半虚拟化 SCSI 驱动程序
device		vmci		# 虚拟机通信接口（VMCI）
device		vmware_guestrpc	# GuestRPC 接口
```

VMware 虚拟机监控程序支持。

```sh
device backlight
```

笔记本电脑专用选项。背光亮度调节。

```sh
device		imcsmb
```

系统管理总线（SMB）。

支持的 SMBus 接口：

- imcsmb：集成内存控制器 (iMC) SMBus 控制器。
- 支持平台：Sandy Bridge-至强、Ivy Bridge-至强、Haswell-至强、Broadwell-至强处理器

```sh
device		iichid		# HID-over-I²C 支持
options 	IICHID_DEBUG	# 启用 HID-over-I²C 调试信息
options 	IICHID_SAMPLING	# 针对缺失 GPIO 中断支持的变通方案
```

HID-over-I²C 支持。

```sh
device		amdsmn
```

AMD 系统管理网络（AMD System Management Network, SMN）

```sh
device		ichwd   # 英特尔 ICH 看门狗定时器
device		amdsbwd # AMD SB7xx 看门狗定时器
device		viawd   # VIA 南桥看门狗定时器
device		wbwd    # Winbond 看门狗定时器
device		itwd    # ITE Super I/O 看门狗定时器
```

硬件看门狗定时器。

```sh
device		coretemp
device		amdtemp
```

温度传感器：

- `coretemp`：英特尔酷睿及更新架构处理器晶圆的内置传感器
- `amdtemp`：AMD K8/K10/K11 系列处理器晶圆的内置传感器

```sh
device		cpuctl
```

CPU 控制伪设备。提供了对 MSR（模型特定寄存器）、CPUID 信息及微代码更新功能的访问。


```sh
device		superio
```

SuperIO 驱动。

```sh
options 	KBDIO_DEBUG=2
options 	KBD_MAXRETRY=4
options 	KBD_MAXWAIT=6
options 	KBD_RESETDELAY=201

options 	PSM_DEBUG=1

options 	TIMER_FREQ=((14318182+6)/12)

options 	VM_KMEM_SIZE
options 	VM_KMEM_SIZE_MAX
options 	VM_KMEM_SIZE_SCALE
```

许多用于代码检查的未公开选项。

>**注意**
>
>原文注释：对此类选项进行的文档编写并不被视为不当行为。

## arm64（aarch64）机器相关配置

- 原文：[sys/arm64/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/arm64/conf/NOTES)：aarch64 机器相关的内核配置说明文件。版本：[LINT: add KDTRACE_MIB_SDT to catch inconsistencies with struct tcpstat](https://github.com/freebsd/freebsd-src/commit/b3d0562dd84540be2fd98e6a457cdcb232e9f915)。



```sh
#profile         2
```

我们希望 LINT 也能支持性能分析功能，但该功能目前存在缺陷。


```sh
options 	KDTRACE_HOOKS
options 	KDTRACE_MIB_SDT
```

启用加载 DTrace 内核模块所需的内核 DTrace 钩子。

```sh
cpu		ARM64
```

以下内容主要移植自 ARM64 平台的 GENERIC 配置文件。

```sh
makeoptions	DEBUG=-g
```

构建带 gdb(1) 调试符号的内核。

```sh
makeoptions	WITH_CTF=1
```

运行 ctfconvert(1) 来支持 DTrace 功能。

```sh
options 	PRINTF_BUFR_SIZE=128
```

防止 printf 输出内容交错。

```sh
options 	KDTRACE_FRAME
```

确保编译时包含帧信息。

```sh
options 	VFP
```

浮点运算支持。

```sh
options 	RACCT_DEFAULT_TO_DISABLED # Set kern.racct.enable=0 by default
```


### SoC 支持

```sh
options 	SOC_ALLWINNER_A64
```

Allwinner（全志）A64（sun50iw1）片上系统搭载四核 Cortex-A53 ARM 处理器，并集成 ARM Mali400 MP2 图形处理器。

```sh
options 	SOC_ALLWINNER_H5
```

Allwinner（全志）H5（sun50iw2p1）片上系统搭载四核 Cortex-A53 ARM 处理器，并集成 ARM Mali450 MP4 图形处理器。

```sh
options 	SOC_ALLWINNER_H6
```

Allwinner（全志）H6（sun50iw6p1）片上系统搭载四核 Cortex-A53 ARM 处理器，并集成 ARM Mali-T720 MP2 图形处理器。该芯片是专为 OTT 设备设计的片上系统。

```sh
options 	SOC_BRCM_BCM2837
```

这是在树莓派 3B、2B 后续型号以及树莓派计算模块 3 中使用的博通芯片。BCM2837 的底层架构与 BCM2836 相同。唯一明显的区别是用四核 ARM Cortex A53（ARMv8）簇替换了四核 ARMv7 簇。

```sh
options 	SOC_BRCM_BCM2838
```

树莓派 4B 使用的博通芯片。


```sh
options 	SOC_BRCM_NS2
```

博通 Northstar 2 (NS2) SoC。NS2 是一款基于 ARMv8 架构的片上系统，隶属于博通 iProc 产品系列。


```sh
options 	SOC_CAVM_THUNDERX
```

Cavium ThunderX。

```sh
options 	SOC_FREESCALE_IMX8
```

基于 Arm Cortex 架构的 i.MX 8 系列应用处理器。

```sh
options 	SOC_HISI_HI6220
```

华为海思麒麟 620。

```sh
options 	SOC_INTEL_STRATIX10
```

英特尔 Stratix® 10。

```sh
options 	SOC_MARVELL_8K
```

Marvell Armada 8K SoC。


```sh
options 	SOC_NVIDIA_TEGRA210
```

英伟达 Tegra210。


```sh
options 	SOC_NXP_LS
```

NXP Layerscape 处理器。

```sh
options 	SOC_ROCKCHIP
```

瑞芯微。

```sh
options 	SOC_ROCKCHIP_RK3328
```

瑞芯微 RK3328。

```sh
options 	SOC_ROCKCHIP_RK3399
```

瑞芯微 RK3399。

```sh
options 	SOC_ROCKCHIP_RK3568
```

瑞芯微 RK3568。

```sh
options 	SOC_XILINX_ZYNQ
```

AMD Xilinx Zynq。

#### 定时器

```sh
device		aw_timer
```

全志定时器驱动。

### Annapurna Alpine 驱动


```sh
device		al_ccu
```

Alpine 缓存一致性单元。

```sh
device		al_nb_service
```

Alpine 北桥服务。

```sh
device		al_iofic
```

Alpine I/O 架构中断控制器。

```sh
device		al_serdes
```

Alpine 串行器/解串器。

```sh
device		al_udma
```

Alpine 通用 DMA。

### 高通骁龙系列驱动程序

```sh
device		qcom_gcc
```

高通骁龙全局时钟控制器。


### 谷歌虚拟网卡

```sh
device		gve
```

谷歌虚拟网卡（gVNIC）驱动。

### Microsoft Hyper-V


```sh
device		hyperv
```

Microsoft Hyper-V。

### CPU 频率调控

```sh
device		cpufreq
```

CPU 频率调控。

### 硬件加密加速

```sh
device		armv8crypto
```

ARMv8 OpenCrypto 模块。

```sh
device		ossl
```

OpenSSL OpenCrypto 模块。

### 总线驱动

```sh
device		al_pci
```

Annapurna Alpine PCIe。


```sh
options 	PCI_HP
```

PCIe 原生热插拔。

```sh
options 	PCI_IOV		# PCI SR-IOV support
```


### 以太网卡

```sh
device		mdio
```

IEEE 802.3 管理数据输入/输出接口

```sh
device		awg
```

全志 EMAC 千兆以太网

```sh
device		axa
```

AMD Opteron A1100 集成网卡

```sh
device		neta
```

Marvell Armada 370/38x/XP/3700 网卡

```sh
device  	smc
```

SMSC LAN91C111

```sh
device		vnic
```

Cavium ThunderX 网卡

```sh
device		al_eth
```

Annapurna Alpine 以太网网卡

```sh
device  	dwc
```

Synopsys Designware GMAC 以太网

```sh
device		dwc_rk
```

Rockchip Designware

```sh
device		dwc_socfpga
```

Altera SOCFPGA 以太网 MAC

```sh
device		ice
```

Intel 800 系列物理功能

```sh
device		ice_ddp
```

Intel 800 系列 DDP 套件


### Etherswitch 设备

```sh
device		e6000sw
```

基于 Marvell mv88e6085 的交换机


### 存储

```sh
device		mpi3mr			# LSI-Logic MPT-Fusion 4
```

Broadcom MPT Fusion，第 4 版，仅支持 64 位。

### MMC/SD/SDIO 卡槽支持

```sh
device		sdhci_xenon
```

Marvell Xenon SD/MMC 控制器

```sh
device		aw_mmc
```

Allwinner（全志）SD/MMC 控制器

```sh
device		dwmmc
```

SD 总线。

```sh
device		dwmmc_altera
```

Altera SOCFPGA SoC DWMAC 控制器


```sh
device		rk_emmcphy
```

rkemmcphy 驱动控制着 Rockchip SoC 上集成的 eMMC PHY。


### 串行（COM）端口

```sh
device		uart_msm
```

Qualcomm（高通）MSM UART 驱动。

```sh
device		uart_mu
```

RPI3 辅助端口。

```sh
device		uart_mvebu
```

Armada 3700 UART 驱动。

```sh
device		uart_ns8250
```

ns8250 型 UART 驱动。


```sh
device		uart_snps
```

DesignWare Synopsis UART 驱动。

```sh
device		pl011
```

PL011 通用 ARM UART。

### Arm FVP

```sh
options 	SOCDEV_PA=0x1c090000
options 	EARLY_PRINTF=pl011
```

在 Arm FVP 下使用 PL011 UART 进行早期打印（early printf）


### USB

```sh
device		aw_usbphy
```

Allwinner USB PHY。

```sh
device		dwcotg
```

DWC OTG 控制器。

```sh
device		ehci_mv
```

Marvell EHCI USB 接口。

### USB 以太网

```sh
device		muge
```

Microchip LAN78xx USB 千兆以太网驱动。

```sh
device		smsc
```

USB Microchip LAN9xxx 快速以太网驱动。

### 音频

```sh
device a10_codec
```

Allwinner A10 编解码器。

### DMA 控制器

```sh
device		a31_dmac
```

Allwinner A31 (sun6i) SoC DMA 控制器。


### GPIO / 引脚控制（PINCTRL）

```sh
device		a37x0_gpio
```

Marvell Armada 37x0 GPIO 控制器。

```sh
device		aw_gpio
```

 Allwinner GPIO 控制器。

```sh
device		fdt_pinctrl
```

FDT I/O 引脚复用支持。


```sh
device		mv_gpio
```

Marvell GPIO 控制器。

```sh
device		mvebu_pinctrl
```

Marvell Pinmux 控制器。

```sh
device		rk_gpio
```

RockChip GPIO 控制器。

```sh
device		rk_pinctrl
```

RockChip Pinmux 控制器。

### I²C

```sh
device		aw_rsb
```

Allwinner 精简串行总线。

```sh
device		bcm2835_bsc
```

Broadcom BCM283x I²C 总线。

```sh
device		twsi
```

Allwinner I²C 控制器。

```sh
device		rk_i2c
```

RockChip I²C 控制器。

### 时钟与复位控制器

```sh
device		aw_ccu
```

Allwinner 时钟控制器。

### 中断控制器

```sh
device		aw_nmi
```

Allwinner NMI。


```sh
device		mv_cp110_icu
```

Marvell CP110 ICU。

```sh
device		mv_ap806_gicp
```

Marvell AP806 GICP。

### RTC 时钟

```sh
device		aw_rtc
```

Allwinner RTC 时钟。

```sh
device		mv_rtc
```

Marvell RTC 时钟。

### 看门狗控制器

```sh
device		aw_wdog
```

Allwinner 看门狗。


### 电源管理控制器


```sh
device		axp81x
```

X-Powers AXP81x 电源管理。

```sh
device		rk8xx
```

RockChip RK8XX 基础支持。

```sh
device		rk805
```

RockChip RK805 电源管理。

```sh
device		rk808
```

RockChip RK808 电源管理。

```sh
device		rk817
```

RockChip RK817 电源管理。

### 电子熔丝（EFUSE）

```sh
device		aw_sid
```

Allwinner 安全 ID 电子熔丝（Secure ID EFUSE）。

### 热传感器

```sh
device		aw_thermal
```

Allwinner 热传感器控制器。

```sh
device		mv_thermal
```

Marvell 热传感器控制器。

### SPI

```sh
device		bcm2835_spi
```

Broadcom BCM283x SPI 总线。

### PWM

```sh
device		pwm
```

配置 PWM（脉宽调制）硬件

```sh
device		aw_pwm
```

Allwinner PWM 支持。

```sh
device		vt_efifb
```

EFI 帧缓冲终端驱动。

```sh
device		vt_simplefb
```

简单帧缓冲（simple-framebuffer）虚拟终端驱动


```sh
options 	EVDEV_SUPPORT
```

EVDEV。传统驱动中的 evdev 支持。


```sh
device		aw_cir
```

Allwinner 消费类红外（IR）控制器。

```sh
device		clk
device		efidev		# EFI 伪设备
device		efirtc		# EFI RTC
device		phy
device		hwreset
device		nvmem
device		regulator
device		syscon
device		aw_syscon
```

伪设备

```sh
device		backlight
```

背光子系统

### 其他设备

```sh
device		pl330
```

ARM PL330 DMA 控制器。

```sh
device		xdma
```

SoC 片上 DMA 控制器的 xDMA 框架。

```sh
options 	THUNDERX_PASS_1_1_ERRATA
```

芯片特定的修正（Errata）

```sh
options 	EFIRT		# EFI 运行时服务
```

```sh
options 	FDT
```

FDT。

```sh
device		acpi
```

ACPI 支持。

```sh
makeoptions	MODULES_EXTRA="dtb/allwinner dtb/rockchip dtb/rpi"
```

DTB 支持。

```sh
options 	CAMDEBUG
options 	CAM_DEBUG_FLAGS=(CAM_DEBUG_INFO|CAM_DEBUG_PROBE|CAM_DEBUG_PERIPH)
```

添加 camdebug 功能

```sh
options 	MMCCAM
```

同时引入 camified MMC。

```sh
nooptions 	PPC_PROBE_CHIPSET
```

arm64 不支持 inb/outb，因此禁用需要它的芯片组探测。


```sh
nooptions 	DEBUG
```

这些会导致奇怪的问题，原因不明。


```sh
nodevice	snd_cmi
```

对总线标记的假设在 arm64 上不成立。

```sh
nooptions 	COMPAT_FREEBSD4
nooptions 	COMPAT_FREEBSD5
nooptions 	COMPAT_FREEBSD6
nooptions 	COMPAT_FREEBSD7
nooptions 	COMPAT_FREEBSD9
nooptions 	COMPAT_FREEBSD10
```

在这些版本中 arm64 并不存在，因此缺乏所需的兼容支持。直接禁用它们，因为它们没有意义。

```sh
options 	COMPAT_FREEBSD32	# 与 FreeBSD/arm 兼容
```

arm64 支持 32 位 FreeBSD/arm 二进制文件（armv[6|7] ABI）。


```sh
options		IOMMU
```

ARM64 SMMU/IOMMU。


### ZFS

```sh
options 	ZFS
```

ZFS 文件系统。


### HID-over-I2C

```sh
device		iichid
```

HID-over-I2C 支持。

```sh
options 	IICHID_DEBUG
```

启用 HID-over-I2C 调试信息。

```sh
options 	IICHID_SAMPLING
```

针对缺失的 GPIO 中断支持的解决方法。

## armv7/32 位 arm 机器相关配置

- 原文：[sys/arm/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/arm/conf/NOTES)：armv7 机器相关的内核配置说明文件。版本：[arm: tweak imx module build logic](https://github.com/freebsd/freebsd-src/commit/5aefe9f16f240696142894bdeabcebbb057c7053)。

此架构将被淘汰，没有整理内核选项的必要。

## 64 位 RISC-V 机器相关配置

- 原文：[sys/riscv/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/riscv/conf/NOTES)：riscv64（64 位 RISC-V）机器相关的内核配置说明文件。100 行。版本：[riscv: support PV_STATS pmap option](https://github.com/freebsd/freebsd-src/commit/88d81453b1151f8b133023073f3a773dd78cdc3a)。


```sh
cpu RISCV
```

将处理器体系结构指定为 RISC-V。

```sh
makeoptions        DEBUG=-g
```

构建带 gdb(1) 调试符号的内核。

```sh
makeoptions        WITH_CTF=1
```

运行 ctfconvert(1) 以支持 DTrace。

```sh
options         PRINTF_BUFR_SIZE=128
```

防止 printf 输出交错。

```sh
options         KDTRACE_FRAME
```

确保帧被编译进去。

```sh
options         KDTRACE_HOOKS
```

内核 DTrace 钩子。

```sh
options         DDB_CTF
```

内核 ELF 链接器加载 CTF 数据。

```sh
options         RACCT_DEFAULT_TO_DISABLED
```

将 `kern.racct.enable` 默认值设为 `0`。

```sh
options         PV_STATS
```

启用 PV 入口分配器的详细统计功能。

```sh
device rcons
```

RISC-V SBI 控制台。

```sh
device clk
device hwreset
device phy
device regulator
device syscon
device syscon_power
device riscv_syscon
```

伪设备。

```sh
device backlight
```

背光子系统。

```sh
device dwmmc
```

MMC/SD/SDIO 卡槽支持。

```sh
device dtrace
```

DTrace 核心。

>**注意**
>
>选项 `dtrace` 会将 CDDL 许可协议授权的组件引入内核。

```sh
device dtraceall
```

内置所有 DTrace 模块。

### 串行（COM）端口

```sh
device uart_lowrisc
```

lowRISC UART 驱动程序。

```sh
device uart_ns8250
```

ns8250 型 UART 驱动程序。

### RTC 实时时钟

```sh
device da9063_rtc
```

Dialog Semiconductor DA9063 实时时钟。

```sh
device goldfish_rtc
```

QEMU 实时时钟。

### 以太网驱动

```sh
device          dwc
```

Synopsys DesignWare GMAC 以太网。

```sh
device xae
```

Xilinx AXI 以太网 MAC。

### DMA 支持

```sh
device xdma
```

DMA 接口。

```sh
device axidma
```

Xilinx AXI DMA 控制器

### SPI

```sh
device xilinx_spi
```

Xilinx AXI 四路 SPI 控制器。

### 电源管理控制

```sh
device da9063_pmic
```

Dialog Semiconductor DA9063 电源管理集成电路（PMIC）。

### SiFive 设备驱动

```sh
device fe310aon
device fu740_pci_dw
device sifive_gpio
device sifive_spi
files "../sifive/files.sifive"
```


### 扁平化设备树（Flattened Device Tree，FDT）

```sh
options         FDT
makeoptions        MODULES_EXTRA+="dtb/sifive"
```


### FreeBSD/riscv 在这些版本中尚未存在

```sh
nooptions         COMPAT_FREEBSD4
nooptions         COMPAT_FREEBSD5
nooptions         COMPAT_FREEBSD6
nooptions         COMPAT_FREEBSD7
nooptions         COMPAT_FREEBSD9
nooptions         COMPAT_FREEBSD10
nooptions         COMPAT_FREEBSD11
```


### 由于 RISC-V 架构不支持 inb/outb 指令，因此禁用需要这些指令的芯片组探测功能

```sh
nooptions         PPC_PROBE_CHIPSET
```

### 在 RISC-V 架构上，关于总线标签的某些假设并不成立

```sh
nodevice        snd_cmi
```


### hwpmc(4) 功能目前尚未实现

```sh
nodevice        hwpmc
nooptions         HWPMC_HOOKS
```


### RISC-V 架构目前尚未实现原子操作指令 `atomic_testandset_int` 与 `atomic_testandclear_int`

```sh
nodevice        ccr
nodevice        cxgbe
nodevice        cxgbev
```

## powerpc（32/64 位）机器相关配置

- 原文：[sys/powerpc/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/powerpc/conf/NOTES)：powerpc/powerpc64/powerpc64le 机器相关的内核配置说明文件。不到 100 行。版本：[LINT: Don't build bnxt on 32-bit platforms](https://github.com/freebsd/freebsd-src/commit/5aefe9f16f240696142894bdeabcebbb057c7053)。



### DTrace

```sh
options         KDTRACE_HOOKS
```

启用加载 DTrace 内核模块所需的内核 DTrace 钩子。

```sh
#device dtrace
```

DTrace 核心。

>**注意**
>
>此操作会将 CDDL 许可协议授权的组件引入内核。

```sh
#device dtrace_profile
#device dtrace_sdt
#device dtrace_fbt
#device dtrace_systrace
#device dtrace_prototype
#device dtnfscl
#device dtmalloc
```

DTrace 模块。

```sh
#device dtraceall
```

包含所有 DTrace 模块（可选）。

### CPU 选项

```sh
#machine powerpc powerpc[64]
```

必须指定 `machine` 指令才能选择 powerpc 或 powerpc64 架构

### CPU 类型

必须至少指定一种 CPU（即计划运行的处理器型号）。

```sh
cpu AIM
```

AIM 联盟：指苹果、IBM 和摩托罗拉。

```sh
#cpu BOOKE_E500
```

飞思卡尔 32 位处理器。


```sh
options         FPU_EMU
```

浮点运算单元仿真器。


```sh
#options         MPC85XX
```

飞思卡尔处理器。

```sh
options         POWERMAC
```

NewWorld 系列 Apple PowerMac。

```sh
#options         PS3
```

Sony PlayStation 3。

```sh
options         PSIM
```

GDB PSIM PowerPC 模拟器。

```sh
options         MAMBO
```

IBM Mambo 全系统模拟器。

```sh
options         QEMU
```

QEMU 处理器模拟器。


#### cpufreq(4)

```sh
device cpufreq
```

cpufreq 驱动为 CPU 频率调控提供了支持。

#### 标准总线

```sh
device agp
```

AGP（Accelerated Graphics Port，加速图形端口）总线。

```sh
device glc
```

Sony Playstation 3 以太网。

```sh
device kiic
```

Apple Keywest I2C 控制器。

```sh
device ofwd
```

Open Firmware 磁盘。

```sh
device adb
```

Apple 桌面总线。

```sh
device cuda
```

VIA-CUDA ADB 接口。

```sh
device          ad7417
```

PowerMac7,2 温度传感器。


```sh
device ds1631
```

PowerMac11,2 温度传感器。

```sh
device ds1775
```

PowerMac7,2 温度传感器。

```sh
device fcu
```

Apple 风扇控制单元。


```sh
device max6690
```

PowerMac7,2 温度传感器。

```sh
device pmu
```

Apple 电源管理单元。


```sh
device smu
```

Apple 系统管理单元。


```sh
device snd_ai2s
```

Apple I²S 音频。

```sh
device snd_davbus
```

Apple Davbus 音频。

```sh
device adm1030
```

Apple G4 MDD 风扇控制器。

```sh
device backlight
```

背光子系统


### 无需处理的设备

```sh
nodevice        ccr
nodevice        cxgbe # XXX: 仅限在 powerpc64 架构上构建
nodevice        cxgbev
nodevice        bnxt
nodevice        mpr # 无 64 位原子操作
nodevice        mps # 无 64 位原子操作
nodevice        ppc
```

```sh
nodevice        snd_cmi
```

音频。

```sh
nodevice        dcons
nodevice        dcons_crom
```

依赖 gdb_cur。


### 无需处理的选项

```sh
nooption        PPC_DEBUG
nooption        PPC_PROBE_CHIPSET   # 使用 inb/outb
```


