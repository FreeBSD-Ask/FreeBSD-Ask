# 24.4 GENERIC 内核选项（amd64）

理论上，所有 GENERIC 内核选项都能在机器无关选项和 amd64/i386 机器相关选项中找到说明。

详细选项列表及设备行说明可参考对应的 `NOTES` 文件。

GENERIC 的本义是“通用的、一般的、普通的”。GENERIC 内核选项是 amd64 体系架构下所有镜像的默认构建选项（FreeBSD/amd64 通用内核配置文件），但 CURRENT（main 分支）会引入额外的调试选项。

为了便于说明，并避免引入对大多数非开发者无用的调试选项，本文选择 15.0-RELEASE（releng/15.0 分支）的 GENERIC 内核选项进行说明。

- 原文：[sys/amd64/conf/GENERIC](https://github.com/freebsd/freebsd-src/blob/releng/15.0/sys/amd64/conf/GENERIC)
- 版本说明：[u2f(4): Invert U2F_MAKE_UHID_ALIAS kernel build option](https://github.com/freebsd/freebsd-src/blob/releng/15.0/sys/amd64/conf/GENERIC)。全文近 400 行。


```ini
cpu		HAMMER
```

HAMMER 是 AMD K8 的研发代号，即 Opteron（皓龙）和 Athlon64（速龙）。

```ini
ident		GENERIC
```

这是内核的“标识符”。

通常应与内核的名称相同。该选项用于将内核名称设置为 `GENERIC`。至少需要一行 `ident` 条目。

```ini
makeoptions	DEBUG=-g
```

构建包含 gdb(1) 调试符号的内核。

```ini
makeoptions	WITH_CTF=1
```

为支持 DTrace，运行 [ctfconvert(1)](https://man.freebsd.org/cgi/man.cgi?query=ctfconvert&sektion=1&format=html) 将调试数据转换为 CTF 数据。



```ini
options 	SCHED_ULE
```

ULE 调度器。

```ini
options 	NUMA
```

非一致性内存架构（NUMA）支持。

```ini
options 	PREEMPTION
```

启用内核线程抢占。


```ini
options 	EXTERR_STRINGS
```

其曾用名为 `BLOAT_KERNEL_WITH_EXTERR`，用于启用内核扩展错误信息。参见 [Extended errors from kernel](https://reviews.freebsd.org/D50483)。

```ini
options 	VIMAGE
```

用于子系统虚拟化，例如 VNET。

```ini
options 	INET
```

IPv4 协议簇。IP 协议簇是一组协议，位于互联网协议（IP）之上，并使用互联网地址格式。该协议簇为 `SOCK_STREAM`、`SOCK_DGRAM` 和 `SOCK_RAW` 套接字类型提供协议支持；其中 `SOCK_RAW` 接口提供了对 IP 协议的访问。


```ini
options 	INET6
```

IPv6 协议簇。

```ini
options 	IPSEC_SUPPORT
```

允许通过 `kldload` 命令加载 `ipsec` 和 `tcpmd5` 模块。


```ini
options 	IPSEC_OFFLOAD
```

内联 IPsec 卸载基础设施。


```ini
options 	ROUTE_MPATH
```

Multipath 路由支持。

```ini
options 	FIB_ALGO
```

模块化 FIB 查找支持。

```ini
options 	TCP_OFFLOAD
```

TCP 卸载支持。

```ini
options 	TCP_BLACKBOX
```

增强的 TCP 事件日志功能。

```ini
options 	TCP_HHOOK
```

TCP 的 hhook(9) 框架支持。

```ini
options 	TCP_RFC7413
```

TCP 快速打开

```ini
options 	SCTP_SUPPORT
```

允许加载 SCTP KLD 模块支持。

```ini
options 	KERN_TLS
```

TLS 发送和接收卸载。

```ini
options 	FFS
```

伯克利快速文件系统（FFS）。

```ini
options 	SOFTUPDATES
```

启用 FFS 软更新支持。

```ini
options 	UFS_ACL
```

访问控制列表支持。

```ini
options 	UFS_DIRHASH
```

提升大目录的性能。

```ini
options 	UFS_GJOURNAL
```

启用基于 gjournal 的 UFS 日志。

```ini
options 	QUOTA
```

启用 UFS 磁盘配额。

```ini
options 	MD_ROOT
```

允许 MD 设备作为根设备。

```ini
options 	NFSCL
```

网络文件系统（NFS）客户端。

```ini
options 	NFSD
```

网络文件系统（NFS）服务器。

```ini
options 	NFSLOCKD
```

网络锁管理器（NLM）。

```ini
options 	NFS_ROOT
```

将 NFS 用作 `/`，依赖 `NFSCL`。

```ini
options 	MSDOSFS
```

MS-DOS 文件系统。

```ini
options 	CD9660
```

ISO 9660 文件系统。

```ini
options 	PROCFS
```

Proc 进程文件系统（需要 PSEUDOFS 支持）。

```ini
options 	PSEUDOFS
```

伪文件系统框架。

```ini
options 	TMPFS
```

高效的内存文件系统。

```ini
options 	GEOM_RAID
```

软件 RAID 支持。

```ini
options 	GEOM_LABEL
```

提供 GEOM 标签功能。

```ini
options 	EFIRT
```

EFI 运行时服务支持。

```ini
options 	COMPAT_FREEBSD32
```

兼容 i386 二进制程序。

```ini
options 	COMPAT_FREEBSD4
```

兼容 FreeBSD 4。

```ini
options 	COMPAT_FREEBSD5
```

兼容 FreeBSD 5。

```ini
options 	COMPAT_FREEBSD6
```

兼容 FreeBSD 6。

```ini
options 	COMPAT_FREEBSD7
```

兼容 FreeBSD 7。

```ini
options 	COMPAT_FREEBSD9
```

兼容 FreeBSD 9。

```ini
options 	COMPAT_FREEBSD10
```

兼容 FreeBSD 10。

```ini
options 	COMPAT_FREEBSD11
```

兼容 FreeBSD 11。

```ini
options 	COMPAT_FREEBSD12
```

兼容 FreeBSD 12。

```ini
options 	COMPAT_FREEBSD13
```

兼容 FreeBSD 13。

```ini
options 	COMPAT_FREEBSD14
```

兼容 FreeBSD 14。

```ini
options 	SCSI_DELAY=5000
```

在探测 SCSI 设备前的延迟时间（毫秒）。

```ini
options 	KTRACE
```

ktrace(1) 支持。

```ini
options 	STACK
```

stack(9) 支持。

```ini
options 	SYSVSHM
```

SYSV 风格共享内存。

```ini
options 	SYSVMSG
```

SYSV 风格消息队列。

```ini
options 	SYSVSEM
```

SYSV 风格信号量。

```ini
options 	_KPOSIX_PRIORITY_SCHEDULING
```

POSIX P1003_1B 实时扩展。

```ini
options 	PRINTF_BUFR_SIZE=128
```

防止 printf 输出内容交错。

```ini
options 	KBD_INSTALL_CDEV
```

在 `/dev` 中生成字符设备（CDEV）条目。

```ini
options 	HWPMC_HOOKS
```

hwpmc(4) 所需的内核钩子。

```ini
options 	AUDIT
```

安全事件审计。

```ini
options 	CAPABILITY_MODE
```

Capsicum 能力模式。

```ini
options 	CAPABILITIES
```

Capsicum 能力

```ini
options 	MAC
```

TrustedBSD MAC 框架

```ini
options 	KDTRACE_FRAME
```

确保内核编译时包含栈帧信息。

```ini
options 	KDTRACE_HOOKS
```

内核 DTrace 钩子

```ini
options 	DDB_CTF
```

允许内核 ELF 链接器加载 CTF 数据。

```ini
options 	INCLUDE_CONFIG_FILE
```

在内核中包含名为 `INCLUDE_CONFIG_FILE` 的配置文件。可以方便地引入更多存在于其他文本中的选项。

```ini
options 	RACCT
```

资源核算框架

```ini
options 	RACCT_DEFAULT_TO_DISABLED
```

默认设置 `kern.racct.enable=0`

```ini
options 	RCTL
```

资源限制框架。


## 调试支持（始终需要）

```
options 	KDB
```

启用内核调试器支持。

```ini
options 	KDB_TRACE
```

打印 Panic 的堆栈跟踪信息。

## 内核转储功能

```ini
options 	EKCD
```

支持加密内核转储。

```ini
options 	GZIO
```

支持使用 gzip 压缩的内核转储和用户转储。


```ini
options 	ZSTDIO
```

支持使用 zstd 压缩的内核转储和用户转储。

```ini
options 	DEBUGNET
```

debugnet 网络支持。

```ini
options 	NETDUMP
```

netdump(4) 客户端支持。

```ini
options 	NETGDB
```

netgdb(4) 客户端支持。

```ini
options 	SMP
```

默认生成支持 SMP（对称多处理器）的内核。

```ini
device		cpufreq
```

CPU 频率控制支持。

## 总线支持

```
device		acpi
```

ACPI 支持。


```ini
device		smbios
```

smbios，即 System Management BIOS。提供系统管理 BIOS（System Management BIOS）的基本支持。


```ini
options 	IOMMU
```

启用 IOMMU。

```ini
device		pci
```

通用 PCI/PCIe 总线驱动。

```ini
options 	PCI_HP
```

PCIe 原生热插拔支持。

```
options 	PCI_IOV
```

PCI SR-IOV 支持。

```ini
options 	COMPAT_LINUXKPI
```

启用 Linux 内核编程接口（Linux Kernel Programming Interface，KPI）兼容层。

```ini
options 	PPS_SYNC
```

启用内核 PLL 支持，以使用外部 PPS 信号，并由 ntpd(8) 监控。更多信息请参见 ntpd 文档：[Welcome to the home of the Network Time Protocol (NTP) Project.](http://www.eecis.udel.edu/~ntp)


```ini
device		fdc
```

软盘驱动器支持。


## ATA 控制器

```ini
device		ahci
```

兼容 AHCI 的 SATA 控制器支持。

```ini
device		ata
```

传统 ATA/SATA 控制器支持。

```ini
device		mvs
```

Marvell 88SX50XX/88SX60XX/88SX70XX 及 SoC SATA 控制器。

```ini
device		siis
```

Silicon Image SiI3124/SiI3132/SiI3531 SATA 控制器。


## SCSI 控制器

```ini
device		ahc
```

AHA2940 及板载 AIC7xxx SCSI 设备。

```ini
device		ahd
```

AHA39320/29320 及板载 AIC79xx 设备

```ini
device		hptiop
```

Highpoint RocketRaid 3xxx 系列

```ini
device		isp
```

QLogic 系列控制器。

```ini
#device		ispfw
```

QLogic HBA 的固件，通常以模块形式加载。

```ini
device		mpt
```

LSI Logic MPT-Fusion 控制器。

```ini
device		mps
```

LSI-Logic MPT-Fusion 2

```ini
device		mpr
```

LSI-Logic MPT-Fusion 3

```ini
device		mpi3mr
```

LSI-Logic MPT-Fusion 4

```ini
device		sym
```

NCR/Symbios Logic SCSI 控制器。

```ini
device		isci
```

Intel C600 系列 SAS 控制器。

```ini
device		ocs_fc
```

Emulex 光纤通道（Fibre Channel）适配器。

```ini
device		pvscsi
```

VMware PVSCSI


## ATA/SCSI 外围设备


```ini
device		scbus
```

SCSI 总线（ATA/SCSI 设备所必需）。

```ini
device		ch
```

SCSI 介质切换器

```ini
device		da
```

直接访问设备（如磁盘）。

```ini
device		sa
```

顺序访问设备（磁带等）

```ini
device		cd
```

光盘

```ini
device		pass
```

直通设备（用于直接进行 ATA/SCSI 访问）。

```ini
device		ses
```

机箱服务（SES 和 SAF-TE 协议）。

```ini
#device		ctl
```

CAM 目标层。

## 通过 SCSI 子系统连接的 RAID 控制器

```ini
device		arcmsr
```

Areca SATA II RAID

```ini
device		ciss
```

Compaq Smart RAID 5 系列控制器。

```ini
device		ips
```

IBM (Adaptec) ServeRAID

```ini
device		smartpqi
```

Microsemi smartpqi 驱动

```ini
device		tws
```

LSI 3ware 9750 SATA+SAS 6Gb/s RAID 控制器

```ini
device		aac
```

RAID 控制器，Adaptec FSA RAID 系列。

```ini
device		aacp
```

aac 的 SCSI 直通支持（需要 CAM）。

```ini
device		aacraid
```

PMC 出品的 Adaptec RAID

```ini
device		ida
```

Compaq Smart RAID

```ini
device		mfi
```

LSI MegaRAID SAS

```ini
device		mlx
```

Mylex DAC960 系列

```ini
device		mrsas
```

LSI/Avago MegaRAID SAS/SATA，支持 6Gb/s 和 12Gb/s

```ini
#device		pst
```

Promise SuperTrak SX6000 RAID 控制器。

## NVM Express (NVMe) 支持

```ini
device		nvme
```

基础 NVMe 驱动

```ini
device		nvd
```

将 NVMe 命名空间作为磁盘设备提供，依赖 `nvme`

```ini
device 		ufshci			# UFS 主机控制器
```

通用闪存存储（Universal Flash Storage，UFS）主机控制器接口支持。

```ini
device		vmd
```

Intel 卷管理设备（VMD）支持。


```ini
device		atkbdc
```

AT 键盘控制器。atkbdc0 同时控制键盘和 PS/2 鼠标。

```ini
device		atkbd
```

AT 键盘

```ini
device		psm
```

PS/2 鼠标


```ini
device		kbdmux
```

键盘多路复用器


```ini
device		vga
```

VGA 显卡驱动

```ini
device		splash
```

启动画面和屏幕保护支持

```ini
device		sc
```

syscons 是传统的控制台驱动，功能上类似于 SCO 控制台。

```ini
options 	SC_PIXEL_MODE
```

添加对光栅化文本模式的支持。

```ini
device		vt
device		vt_vga
device		vt_efifb
device		vt_vbefb
```

vt 是默认的视频控制台驱动程序。


```ini
device		agp
```

支持多种 AGP 芯片组。

## CardBus 桥

```ini
device		cbb
```

CardBus（Yenta）桥。

```ini
device		cardbus
```

CardBus（32 位）总线


## 串口（COM 端口）


```ini
device		uart
```

通用 UART 驱动。

## 并行端口

```ini
device		ppc
```

并行端口

```ini
device		ppbus
```

并行端口总线（必需）

```ini
device		lpt
```

打印机

```ini
device		ppi
```

并行端口接口设备

```ini
#device		vpo
```

需要 scbus 和 da

```ini
device		puc
```

多路 I/O 卡和多通道 UART 支持。

```ini
device		iflib
```

使用 iflib 基础设施的 PCI/PCI-X/PCIe 以太网网卡

```ini
device		em
```

Intel PRO/1000 系列千兆以太网网卡。

```ini
device		igc
```

Intel I225 系列 2.5GbE 以太网网卡。

```ini
device		ix
```

Intel PRO/10GbE PCIE PF 以太网

```ini
device		ixv
```

Intel PRO/10GbE PCIE VF 以太网

```ini
device		ixl
```

Intel 700 系列物理功能（Physical Function，PF）。

```ini
device		iavf
```

Intel 自适应虚拟功能（Adaptive Virtual Function，AVF）。

```ini
device		ice
```

Intel 800 系列物理功能（Physical Function，PF）。

```ini
device		vmx
```

VMware VMXNET3 以太网。

```ini
device		axp
```

AMD EPYC 集成网卡（需要 `miibus` 支持）。


## PCI 以太网卡

```ini
device		bxe
```

Broadcom NetXtreme II BCM5771X/BCM578XX 10GbE

```ini
device		le
```

AMD Am7900 LANCE 和 Am79C9xx PCnet

```ini
device		ti
```

Alteon Networks Tigon I/II 千兆以太网


```ini
device		mlx5
```

基础驱动。

NVIDIA/Mellanox ConnectX-4 及之后型号，仅限以太网：

- 依赖 `COMPAT_LINUXKPI` 和 xz(4)
- mlx5ib 依赖 ibcore 基础设施，默认未内置


```ini
device		mlxfw
```

用于固件更新

```ini
device		mlx5en
```

以太网驱动程序


```ini
device		miibus
```

MII 总线支持。适用于使用通用 MII 总线控制器代码的 PCI 以太网卡。

>**注意**
>
>请务必保留 `device miibus` 这行，以便使用这些网卡！


```ini
device		ae
```

Attansic/Atheros L2 快速以太网

```ini
device		age
```

Attansic/Atheros L1 千兆以太网

```ini
device		alc
```

Atheros AR8131/AR8132 以太网

```ini
device		ale
```

Atheros AR8121/AR8113/AR8114 以太网

```ini
device		bce
```

Broadcom BCM5706/BCM5708 千兆以太网

```ini
device		bfe
```

Broadcom BCM440x 10/100 以太网

```ini
device		bge
```

Broadcom BCM570xx 千兆以太网

```ini
device		cas
```

Sun Cassini/Cassini+ 和 NS DP83065 Saturn

```ini
device		dc
```

DEC/Intel 21143 及各种兼容芯片

```ini
device		et
```

Agere ET1310 10/100/千兆以太网

```ini
device		fxp
```

Intel EtherExpress PRO/100B (82557, 82558)

```ini
device		gem
```

Sun GEM/Sun ERI/Apple GMAC

```ini
device		jme
```

JMicron JMC250 千兆以太网 / JMC260 快速以太网

```ini
device		lge
```

Level 1 LXT1001 千兆以太网

```ini
device		msk
```

Marvell/SysKonnect Yukon II 千兆以太网

```ini
device		nfe
```

nVidia nForce MCP 板载以太网

```ini
device		nge
```

NatSemi DP83820 千兆以太网

```ini
device		re
```

RealTek 8139C+/8169/8169S/8110S

```ini
device		rl
```

RealTek 8129/8139

```ini
device		sge
```

Silicon Integrated Systems SiS190/191

```ini
device		sis
```

Silicon Integrated Systems SiS 900/SiS 7016

```ini
device		sk
```

SysKonnect SK-984x & SK-982x 千兆以太网

```ini
device		ste
```

Sundance ST201（D-Link DFE-550TX）

```ini
device		stge
```

Sundance/Tamarack TC9021 千兆以太网

```ini
device		vge
```

VIA VT612x 千兆以太网

```ini
device		vr
```

VIA Rhine, Rhine II

```ini
device		xl
```

3Com 3c90x（“Boomerang”，“Cyclone”）


## 无线网卡

```ini
device		wlan
```

IEEE 802.11 支持。

```ini
options 	IEEE80211_DEBUG
```

启用调试信息

```ini
options 	IEEE80211_SUPPORT_MESH
```

启用 IEEE 802.11s 草案支持。

```ini
device		wlan_wep
```

802.11 WEP 支持

```ini
device		wlan_tkip
```

802.11 TKIP 支持

```ini
device		wlan_ccmp
```

802.11 CCMP 支持

```ini
device		wlan_gcmp
```

802.11 GCMP 支持

```ini
device		wlan_amrr
```

AMRR 发送速率控制算法（Adaptive Multi Rate Retry）。

```ini
device		ath
```

Atheros CardBus/PCI 网卡

```ini
device		ath_hal
```

Atheros CardBus/PCI 芯片支持

```ini
options 	AH_AR5416_INTERRUPT_MITIGATION
```

AR5416 中断缓解

```ini
device		ath_rate_sample
```

`ath` 的 SampleRate 发送速率控制算法

```ini
#device		bwi
```

Broadcom BCM430x/BCM431x 无线网卡

```ini
#device		bwn
```

Broadcom BCM43xx 无线网卡

```ini
device		ipw
```

Intel 2100 无线网卡

```ini
device		iwi
```

Intel 2200BG/2225BG/2915ABG 无线网卡

```ini
device		iwn
```

Intel 4965/1000/5000/6000 无线网卡

```ini
device		malo
```

Marvell Libertas 无线网卡

```ini
device		mwl
```

Marvell 88W8363 802.11n 无线网卡

```ini
device		ral
```

Ralink Technology RT2500 无线网卡

```ini
device		wpi
```

Intel 3945ABG 无线网卡


## 伪设备

```ini
device		crypto
```

核心加密支持

```ini
device		aesni
```

AES-NI OpenCrypto 加速模块

```ini
device		loop
```

网络回环接口。

```ini
device		padlock_rng
```

VIA Padlock 随机数生成器

```ini
device		rdrand_rng
```

Intel Bull Mountain 随机数生成器

```ini
device		ether
```

以太网支持

```ini
device		vlan
```

802.1Q VLAN 支持

```ini
device		tuntap
```

数据包隧道接口。

```ini
device		md
```

内存“磁盘”

```ini
device		gif
```

IPv6 和 IPv4 隧道

```ini
device		firmware
```

固件辅助模块

```ini
device		xz
```

LZMA 解压支持。

```ini
device		bpf  # 伯克利数据包过滤器
```

`bpf` 设备用于启用伯克利数据包过滤器，启用时需注意其对系统管理的影响。

>**注意**
>
>DHCP 依赖 `bpf`。


## USB 支持

```ini
options 	USB_DEBUG
```

启用 USB 调试信息

```ini
device		uhci
```

UHCI PCI 到 USB 接口

```ini
device		ohci
```

OHCI PCI 到 USB 接口

```ini
device		ehci
```

EHCI PCI 到 USB 接口（USB 2.0）

```ini
device		xhci
```

xHCI PCI 到 USB 接口（USB 3.0）

```ini
device		usb
```

USB 总线（必需）

```ini
device		usbhid
```

USB HID 传输

```ini
device		hkbd
```

HID 键盘

```ini
device		ukbd
```

USB 键盘

```ini
device		umass
```

磁盘 / 大容量存储——需要 `scbus` 和 `da`。


## 音频支持

```ini
device		sound
```

通用声卡驱动（必需项）

```ini
device		snd_cmi
```

CMedia CMI8338/CMI8738

```ini
device		snd_csa
```

Crystal Semiconductor CS461x/428x

```ini
device		snd_emu10kx
```

Creative SoundBlaster Live! 和 Audigy

```ini
device		snd_es137x
```

Ensoniq AudioPCI ES137x

```ini
device		snd_hda
```

Intel 高保真音频

```ini
device		snd_ich
```

Intel、NVIDIA 及其他 ICH AC'97 音频

```ini
device		snd_via8233
```

VIA VT8233x 音频


## MMC/SD

```ini
device		mmc
```

MMC/SD 总线

```ini
device		mmcsd
```

MMC/SD 存储卡

```ini
device		sdhci
```

通用 PCI SD 主控制器


## VirtIO

```ini
device		virtio
```

通用 VirtIO 总线（必需项）

```ini
device		virtio_pci
```

VirtIO PCI 设备

```ini
device		vtnet
```

VirtIO 以太网设备

```ini
device		virtio_blk
```

VirtIO 块设备

```ini
device		virtio_scsi
```

VirtIO SCSI 设备

```ini
device		virtio_balloon
```

VirtIO 内存气球设备


## Linux KVM 半虚拟化支持

```ini
device		kvm_clock
```

KVM 半虚拟化时钟驱动。


## Hyper-V 驱动及增强支持

```
device		hyperv
```

Hyper-V 驱动

## Xen HVM 客户机优化

```ini
options 	XENHVM
```

Xen HVM 内核基础设施。

>**注意**
>
>XENHVM 依赖 xenpci 和 xentimer。它们必须同时存在或同时不存在。

```ini
device		xenefi
```

Xen EFI 定时器设备

```ini
device		xenpci
```

Xen HVM 虚拟机管理器服务驱动

```ini
device		xentimer
```

Xen x86 PV 定时器设备


## netmap(4) 支持

```ini
device		netmap
```

Netmap 提供了对受支持网卡发送 / 接收环路的直接访问支持。


## evdev 接口

```ini
options 	EVDEV_SUPPORT
```

在传统驱动中启用 evdev 接口支持。

```ini
device		evdev
```

输入事件设备支持

```ini
device		uinput
```

安装字符设备（CDEV）`/dev/uinput`。


## HID 支持

```ini
options 	HID_DEBUG
```

启用调试信息输出。

```ini
device		hid
```

通用 HID 支持

```ini
device		hidbus
```

通用 HID 总线

```ini
options 	IICHID_SAMPLING
```

用于解决缺失 GPIO 中断支持问题的变通方法。

## EFI 设备

```ini
device		efidev
```

EFI 伪设备

```ini
device		efirtc
```

EFI 实时时钟

