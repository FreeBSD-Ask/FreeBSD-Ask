# 24.1 FreeBSD 内核选项概述

## 内核配置选项路径

- amd64 内核配置选项位于 [sys/amd64/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/amd64/conf)。
- Arm64 内核配置选项位于 [sys/arm64/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/arm64/conf)。
- RISC-V 内核配置选项位于 [sys/riscv/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/riscv/conf)

## 内核配置文件说明（基于 amd64）

介绍  [freebsd-src/main/sys/amd64/conf](https://github.com/freebsd/freebsd-src/tree/main/sys/amd64/conf)：

- `DEFAULTS`：FreeBSD/amd64 的默认内核配置文件，只有不到 30 行
- `FIRECRACKER`：面向 [Firecracker](https://firecracker-microvm.github.io/) VM 的内核配置文件，参见 [amd64: Add FIRECRACKER kernel configuration](https://reviews.freebsd.org/D36672)
- `GENERIC`：FreeBSD/amd64 通用内核配置文件，所有 amd64 镜像默认基于此。350 余行。
- `GENERIC-KASAN`：调试开发用。参见 [amd64: Add MD bits for KASAN](https://reviews.freebsd.org/D29455)。用于 KASAN（Kernel Address SANitizer，内核地址清理器），参见 [kasan(9)](https://man.freebsd.org/cgi/man.cgi?query=kasan&sektion=9&format=html)，只有不到十行
- `GENERIC-KCSAN`：调试开发用。KCSAN（Kernel Concurrency Sanitizer，内核并发清理器）。30 余行，参见 [Port the NetBSD KCSAN runtime to FreeBSD](https://reviews.freebsd.org/D22315)
- `GENERIC-KMSAN`：调试开发用。不到十行。KMSAN（Kernel Memory SANitizer，内核内存清理器）参见 [KMSAN(9)](https://man.freebsd.org/cgi/man.cgi?query=kmsan&sektion=9&format=html)
- `GENERIC-MMCCAM`：调试开发用。使用 MMCCAM 代替 MMC 栈。不到二十行。参见 [MMC stack on top of CAM framework](https://reviews.freebsd.org/D4761)。
- `GENERIC-NODEBUG`：该文件仅在 [main](https://github.com/freebsd/freebsd-src/blob/main) 分支中存在，用于基准测试。三十余行。基于 GENERIC 配置文件，但是删掉了 [WITNESS (4)](https://man.freebsd.org/cgi/man.cgi?witness(4))（跟踪每个线程获取和释放的锁）和 [INVARIANTS(9)](https://man.freebsd.org/cgi/man.cgi?KASSERT(9))（内核表达式验证宏）。因为 CURRENT 的 GENERIC [默认启用](https://github.com/freebsd/freebsd-src/blob/main/UPDATING) 了上述调试功能，而它们会对系统性能产生影响——通过 `include "std.debug"` 引入，参见 [sys/amd64/conf: unify MINIMAL and GENERIC debug](https://github.com/freebsd/freebsd-src/pull/1124)、[sys/conf/std.debug](https://github.com/freebsd/freebsd-src/blob/main/sys/conf/std.debug)。
- `GENERIC.hints`：一些 [hints](https://man.freebsd.org/device.hints) 参数。二十余行。用于设置驱动的参数。
- `LINT`：LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)，用于验证代码风格格式等。不到五行。
- `LINT-NOINET`：LINT 文件，不到五行，禁用了 [INET(4)](https://man.freebsd.org/cgi/man.cgi?query=inet&sektion=4&man)（IPv4）。LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)。
- `LINT-NOINET6`：LINT 文件，不到五行，禁用了 [INET(6)](https://man.freebsd.org/cgi/man.cgi?query=inet6&sektion=4&man)（IPv6）。LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)。
- `LINT-NOIP`：LINT 文件，不到三十行，禁用了 IP 协议相关（IPv4、IPv6、TLS 等）。LINT 文件，参见 [Eliminate building LINT makefiles](https://reviews.freebsd.org/D26540)。
- `LINT-NOVIMAGE`：调试开发用。LINT 文件，不到五行，禁用了 [VIMAGE (9)](https://man.freebsd.org/cgi/man.cgi?query=vimage&sektion=9)（实际上是 VNET(9) 的别名，网络子系统虚拟化基础设施）。参见 [sys: add LINT-NOVIMAGE](https://reviews.freebsd.org/D50780)
- `MINIMAL`：FreeBSD/amd64 中最常用的最简内核配置选项。160 余行。
- `MINIMAL-NODEBUG`：等同于 GENERIC-NODEBUG，只不过是 `MINIMAL` 版本的。不到 15 行。

## 内核选项说明文件

- [sys/amd64/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/amd64/conf/NOTES)：amd64 机器相关的内核配置说明文件。不到 200 行。
- [sys/x86/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/x86/conf/NOTES)：i386 和 amd64 共用的机器相关配置。650 余行。
- [sys/arm64/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/arm64/conf/NOTES)：arm64（aarch64）机器相关的内核配置说明文件。不到 270 行。
- [sys/arm/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/arm/conf/NOTES)：armv7/32 位 arm 机器相关的内核配置说明文件。不到 100 行。
- [sys/riscv/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/riscv/conf/NOTES)：riscv64（64 位 RISC-V）机器相关的内核配置说明文件。100 行。
- [sys/powerpc/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/powerpc/conf/NOTES)：powerpc/powerpc64/powerpc64le 机器相关的内核配置说明文件。不到 100 行。
- [sys/conf/NOTES](https://github.com/freebsd/freebsd-src/blob/main/sys/conf/NOTES)：机器无关的说明，近 2900 行。
