# 26.4 OpenBSD 包管理器

与其他 BSD 系统一样，OpenBSD 的软件安装主要有两种方式：一种是使用官方预编译的二进制包，另一种是通过 ports 源代码自行打包安装。这里推荐使用第一种方式。

## 二进制包

在线查询：<https://openports.pl/>

推荐使用二进制包方式安装软件，以 Firefox 浏览器为例：

- 安装软件

```sh
# pkg_add firefox  # 安装 Firefox 浏览器
```

- 删除软件

```sh
# pkg_delete firefox  # 卸载已安装的 Firefox 浏览器
```

- 查询软件和安装信息

```sh
# pkg_info -Q firefox  # 查询系统中是否已安装 Firefox 及其安装信息
```

- 更新已安装软件包及其依赖的软件包

```sh
# pkg_add -iu firefox  # 安装或升级 Firefox 到最新版本
```

- 删除不需要的依赖包

```sh
# pkg_delete -a  # 删除未使用的依赖项（即不被任何手动安装的软件包依赖的包）
```

### 换源

首先安装文本编辑器，因为 OpenBSD 默认使用的是 [nvi](https://man.openbsd.org/vi)。


安装 ee 文本编辑器：

```sh
# pkg_add ee  # 或者你还可以用 nano，即 pkg_add nano
```

如果无法或不想安装 ee 或 nano 等编辑器，也可以使用类似 WinSCP 的软件进行文件修改。

打开 `/etc/installurl` 文件，将默认源注释掉，即在 `https://cdn.openbsd.org/pub/OpenBSD` 前加 `#`：`#https://cdn.openbsd.org/pub/OpenBSD`。

在文件中另起一行，添加内容 `https://mirrors.tuna.tsinghua.edu.cn/OpenBSD/`。

此处选择 TUNA 清华大学开源软件镜像站，也可以选择：

- 阿里巴巴开源镜像站 [https://mirrors.aliyun.com/openbsd](https://mirrors.aliyun.com/openbsd)
- 南京大学开源镜像站 [https://mirror.nju.edu.cn/OpenBSD](https://mirror.nju.edu.cn/OpenBSD)

## ports


[查询网站](https://openports.pl/)

CVS 在线浏览地址：<https://cvsweb.openbsd.org/>

OpenBSD 对应多个系统版本（release、stable 和 current），不同版本的 ports 之间不通用。

release 版本的 ports 不会更新，版本号是固定的。如需使用滚动版本，需要使用 stable 或 current 系统。

升级系统需要通过源代码更新或安装快照版本（current），地址为：<https://cdn.openbsd.org/pub/OpenBSD/snapshots/amd64/>。

- 对于 release 版本，可直接下载压缩包并解压到 `/usr` 目录，例如：<https://cdn.openbsd.org/pub/OpenBSD/7.5/ports.tar.gz>

- current:

```sh
$ cd /usr                                                 # 进入 /usr 目录
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -P ports   # 从 OpenBSD CVS 仓库检出 Ports 树
```

- 对于 7.7 stable 版本：

```sh
$ cd /usr                                                 # 进入 /usr 目录
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -rOPENBSD_7_7 -P ports   # 从 OpenBSD CVS 仓库检出指定版本 OPENBSD_7_7 的 Ports 树
```

更新 ports：

```sh
$ cvs up -r TAG -Pd  # 使用 CVS 更新代码到指定标签 TAG，同时创建目录并删除不存在的文件
```

### 参考资料

- [Ports - Working with Ports](https://www.openbsd.org/faq/ports/ports.html)
- [Anonymous CVS](https://www.openbsd.org/anoncvs.html)
- [Following -current and using snapshots](https://www.openbsd.org/faq/current.html)


## pkgsrc

pkgsrc 为 NetBSD 的软件包管理系统，不过它宣称同样支持 Linux 和 其它 BSD 系统。pkgsrc 的软件包数量似乎多于 OpenBSD 官方提供的软件包，但需要注意 pkgsrc 与 OpenBSD 的兼容性是否良好。以下内容仅供感兴趣的网友尝试，不能保证没有意外，我们也不推荐以 pkgsrc 为主力包管理系统。

```sh
$ cd ~/                               # 切换到当前用户主目录
$ ftp https://cdn.NetBSD.org/pub/pkgsrc/pkgsrc-2023Q2/pkgsrc.tar.gz  # 从官方 FTP 下载 pkgsrc 压缩包
$ tar -xzf pkgsrc.tar.gz              # 解压下载的 pkgsrc 压缩包
$ cd pkgsrc/bootstrap                 # 进入 bootstrap 目录
$ ./bootstrap --unprivileged          # 以非特权用户方式启动 pkgsrc 引导安装
```

接着需要将路径 `~/pkg/bin` 添加到环境变量中。pkgsrc 树位于 `~/pkgsrc/`，其所有相关工作文件均位于 `~/pkg/`。

可以在 `~/pkgsrc/` 中搜索软件并安装，安装时使用命令 `bmake install`，例如在 `~/pkgsrc/chat/irssi/` 安装 IRC 客户端 IRSSI。

