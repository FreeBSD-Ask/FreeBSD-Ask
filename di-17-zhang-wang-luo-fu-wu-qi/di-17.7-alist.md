# 17.7 OpenList

- 功能请求：做成 Port。

## 安装

### 官方二进制包

请以普通用户执行：

```sh
$ mkdir openlist
$ cd openlist
$ fetch https://github.com/OpenListTeam/OpenList/releases/download/v4.0.8/openlist-freebsd-amd64.tar.gz
$ tar zxvf openlist-freebsd-amd64.tar.gz
$ rm openlist-freebsd-amd64.tar.gz
```

>**注意**
>
>根据 [手动安装](https://docs.oplist.org/zh/guide/install/manual.html) 所述及实际测试，无需额外配置后端 OpenList-Frontend。

### 编译安装（可选）


#### 安装依赖

- 使用 pkg 安装

```sh
# pkg install git go
```

- 或者使用 Ports 安装

```sh
# cd /usr/ports/devel/git/ && make install clean
# cd /usr/ports/lang/go/ && make install clean
```

#### 编译构建

请以普通用户执行：

- 下载源码

```sh
$ git clone -b v4.0.8 https://github.com/OpenListTeam/OpenList # 写作本文时，最新版本为 v4.0.8
$ cd OpenList/public/dist
$ fetch https://github.com/OpenListTeam/OpenList-Frontend/releases/download/v4.0.8/openlist-frontend-dist-v4.0.8.tar.gz  # 这是前端部分，官方已经编译好的，注意要和后端版本相对应，即也是 v4.0.8
$ tar zxvf openlist-frontend-dist-v4.0.8.tar.gz  # 解压缩
$ rm openlist-frontend-dist-v4.0.8.tar.gz # 清理垃圾
$ cd ../..
```

- 开始构建

```bash
$ mkdir build
$ cd build
$ go build -ldflags="-w -s" -tags=jsoniter ..
```
 
编译后的文件即在 `build` 下。叫 `OpenList`，为了方便使用，在以下教程中笔者将其重命名为 `openlist`。


## 编写 RC 脚本

创建并编辑 `/usr/local/etc/rc.d/openlist`：

```sh
#!/bin/sh
. /etc/rc.subr

name="openlist"
rcvar="openlist"
command_path=/home/ykla/OpenList     # 可执行文件 openlist 所在目录
command="${command_path}/openlist"   # 命令路径
command_args="start"                 # 启动命令参数
stop_cmd=do_stop                     # 停止命令参数

do_stop()
{
    ${command} stop
}

load_rc_config $name                 # 载入 rc.conf 文件中定义的变量
: ${openlist_enable:=no}             # 如果未设置 openlist_enable 则设为 no
run_rc_command "$1"                  # 运行 service 命令
```

增加执行权限

```sh
# chmod +x /usr/local/etc/rc.d/openlist
```

## 使用 openlist 服务

```sh
# service openlist enable
```

增强安全，使用普通用户执行进程（ykla 是我的普通用户名，改成你自己的）：

```sh
# sysrc openlist_user=ykla
```

>**警告**
>
>注意 `OpenList` 目录的属主和组都必须是 `ykla`，即你的普通用户名。否则会报错：
>
>`FATA[2025-07-06 11:27:56] 1511: failed to open start log file:open /home/ykla/OpenList/daemon/start.log: no such file or directory`。
>
>修改命令类似于（修改 OpenList 目录及其中所有文件的属主为 ykla）：
>
>```sh
># chown -R ykla:ykla /home/ykla/OpenList
>```

## 初始化

```sh
# service openlist start # 先启动服务
Starting openlist.
INFO[2025-07-06 11:32:41] success start pid: 1566
```

重置 `admin` 密码为 `1`：

```sh
root@ykla:/home/ykla/OpenList # ./openlist admin set 1 
INFO[2025-07-06 11:39:39] reading config file: data/config.json        
INFO[2025-07-06 11:39:39] load config from env with prefix: OPENLIST_  
INFO[2025-07-06 11:39:39] init logrus...                               
INFO[2025-07-06 11:39:39] admin user has been updated:                 
INFO[2025-07-06 11:39:39] username: admin                              
INFO[2025-07-06 11:39:39] password: 1  
```

## 登录

`http://ip:5244`，请将 `ip` 改为你的局域网地址。用户名是 `admin`。

![OpenList in FreeBSD](../.gitbook/assets/alist.png)

![OpenList in FreeBSD](../.gitbook/assets/alist2.png)

### 参考文献

- [alist 指定 --data 运行不起作用](https://github.com/AlistGo/alist/issues/2580)。
- 另外 [start 等静默启动](https://alist.nn.ci/zh/guide/install/manual.html#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B) 会强制 `--force-bin-dir`。对于 `start` 指定任何 `data` 均会在后面附带  `--force-bin-dir`。但是仍然是无效的。

## 指定 vlc 为 OpenList 的外部播放器

OpenList 中的内嵌播放器有时不能播放某些视频，但 OpenList 可以通过 URI 调用外部程序（通过 `xdg-open` )。OpenList 为 vlc 指定的视频地址形如 `vlc://http://xxx`，只要为 `vlc://` 开头的 URI 指定 vlc 程序即可。请自行安装 vlc。

`xdg-open` 向 vlc 传递 URI 时会包含 `vlc://` , vlc 不能打开这样的地址，需要在打开视频地址前先去除，然后调用 vlc，下面是要调用的脚本：

```sh
safreya ~ % cat ~/.local/share/applications/vlc-noschema.sh
#!/bin/sh
url="$1"
clean_url="${url#vlc://}"           # 去除 vlc:// 头
vlc "$clean_url"
```

增加执行权限

```sh
$ chmod u+x ~/.local/share/applications/vlc-noschema.sh
```

新建 `.desktop` 文件，以便 xdg-open 调用上面的脚本：

```sh
safreya ~ % cat ~/.local/share/applications/userapp-vlc.desktop
[Desktop Entry]
Encoding=UTF-8
Version=1.0
Type=Application
NoDisplay=true
Exec=/home/safreya/.local/share/applications/vlc-noschema.sh %U
Name=vlc
Comment=Custom definition for vlc
```

注册 `vlc://` URI 的调用程序

```sh
$ update-desktop-database ~/.local/share/applications
$ xdg-mime default userapp-vlc.desktop x-scheme-handler/vlc
```

## 故障排除与未竟事宜

### 日志

OpenList 的日志在 `daemon/start.log`。
