# 18.5 Radxa X4（x86）

Radxa X4 是基于 x86 的开发板，搭载英特尔 N100 处理器。本文以 16G 内存和 128G eMMC 版本为基础。

如需解锁 PL1、PL2 等 BIOS 设置，请参见“UEFI/BIOS 注解（基于 AMI BIOS）”一节。

请安装 FreeBSD 15.0-CURRENT。FreeBSD 15.0 存在一个问题，CPU 主频无法达到 3 GHz。参见 [Bug 271548 - Alder lake CPU not running at full speed](https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=271548)

- FreeBSD 14.3-RELEASE 可能存在问题：如果使用 eMMC 版本（且 FreeBSD 系统安装在 eMMC 上），固态硬盘的分区不能超过 5 个，否则 ZFS 无法启动。
- FreeBSD 14.2-RELEASE 似乎不支持 CPU 睿频调节。

无线网卡型号为 RTL8852BE（瑞莎 A8 无线模块 V2.0），其中无线使用 PCIe 通道，蓝牙使用 USB 通道。

Radxa X4 的以太网卡型号为英特尔 i226-V。

## 安装显卡驱动

使用 pkg 安装：

```sh
# pkg install drm-61-kmod
```

或使用 ports 安装：

```sh
# cd /usr/ports/graphics/drm-61-kmod/ 
# make install clean
```

### 配置显卡驱动

在 `/etc/rc.conf` 中添加 `i915kms` 内核模块，以便开机时自动加载：

```sh
# sysrc -f /etc/rc.conf kld_list+=i915kms
```

## 安装无线网卡驱动

使用 pkg 安装：

```sh
# pkg install wifi-firmware-rtw89-kmod
```

或使用 ports 安装：

```sh
# cd /usr/ports/net/wifi-firmware-rtw89-kmod/ 
# make install clean
```

### 配置无线网卡驱动

目前不支持 Wi-Fi 5/6 标准。

在 2.4 GHz 频段，传输速率只能达到 11n；在 5 GHz 频段，传输速率只能达到 11a。

根据 [man rtw89](https://man.freebsd.org/cgi/man.cgi?query=rtw89&apropos=0&sektion=4&manpath=FreeBSD+15.0-CURRENT&arch=default&format=html)，编辑 `/boot/loader.conf`，加入一行 

```ini
compat.linuxkpi.skb.mem_limit=1
```

设置 Linux KPI 网络缓冲区内存限制为 `1`。该设置可以解决长时间无法自动连接 Wi-Fi 的问题。


## 查看实时状态（内存，网速，硬盘读写等）

该命令每秒刷新一次虚拟内存及系统状态信息：

```sh
# systat -vmstat 1
    2 users    Load  2.01  3.28  3.42                  Mar  9 12:26:41
   Mem usage:  91%Phy 52%Kmem                           VN PAGER   SWAP PAGER
Mem:      REAL           VIRTUAL                        in   out     in   out
       Tot   Share     Tot    Share     Free   count
Act   432M  10400K   4610G   15868K    1373M   pages
All   434M  12244K   4610G   87652K                       ioflt  Interrupts
Proc:                                                     cow    3273 total
  r   p   d    s   w   Csw  Trp  Sys  Int  Sof  Flt   663 zfod        sdhci_pci0
  1           41        4K  684  138   2K       663       ozfod  1030 cpu0:timer
                                                         %ozfod   204 cpu1:timer
 0.2%Sys   0.2%Intr 25.3%User  0.0%Nice 74.3%Idle         daefr     3 cpu2:timer
|    |    |    |    |    |    |    |    |    |    |       prcfr     9 cpu3:timer
>>>>>>>>>>>>>                                             totfr  2022 xhci1 129
                                           dtbuf          react       igc0:rxq0
Namei     Name-cache   Dir-cache    345474 maxvn          pdwak     3 igc0:rxq1
   Calls    hits   %    hits   %    252374 numvn      249 pdpgs       igc0:rxq2
       3       3 100                176597 frevn          intrn     2 igc0:rxq3
                                                    8298M wire        igc0:aq
Disks mmcsd mmcsd mmcsd  nda0 pass0                  581M act         nvme0:admi
KB/t   0.00  0.00  0.00  0.00  0.00                 5380M inact       nvme0:io0
tps       0     0     0     0     0                  548K laund       nvme0:io1
MB/s   0.00  0.00  0.00  0.00  0.00                 1373M free        nvme0:io2
%busy     0     0     0     0     0                   57K buf         nvme0:io3
                                                                      hdac0 140
```

## CPU 温度

### 读取 CPU 温度

动态加载 `coretemp` 内核模块，用于监控 CPU 温度：

```sh
# kldload coretemp # 英特尔加载 coretemp，AMD 请使用 amdtemp
# sysctl -a | grep temperature
hw.acpi.thermal.tz0.temperature: 27.9C # 此值不代表 CPU 温度，通常为主板温度
dev.cpu.3.temperature: 41.0C
dev.cpu.2.temperature: 40.0C
dev.cpu.1.temperature: 40.0C
dev.cpu.0.temperature: 40.0C
```

查看各 CPU 核心的温度信息：

```sh
# sysctl dev.cpu | grep temperature
dev.cpu.3.temperature: 30.0C
dev.cpu.2.temperature: 30.0C
dev.cpu.1.temperature: 29.0C
dev.cpu.0.temperature: 30.0C
```

疑问：为什么温度不一样？

### 持久化温度设定

为了便于 htop 等软件读取 CPU 温度，编辑 `/boot/loader.conf` 文件，添加以下内容：

```ini
coretemp_load="YES"
```

以便开机时自动加载 `coretemp` 内核模块。

### 参考文献

- [coretemp](https://man.freebsd.org/cgi/man.cgi?coretemp)，官方 man 手册，英特尔看这个
- [amdtemp](https://man.freebsd.org/cgi/man.cgi?amdtemp)，官方 man 手册，AMD 看这个
- [FreeBSD find CPU (processor) temperature command](https://www.cyberciti.biz/faq/freebsd-determine-processor-cpu-temperature-command/)，读取 CPU 温度

## 附录：Server 2025 如何安装英特尔 i226-V 网卡驱动

i226-V 在 Windows Server 下可使用 I226-LM 驱动（I226-LM 与 I226-V 功能相同），无需修改任何文件或系统配置：

- 首先下载并解压驱动 [适用于 Windows Server 2025* 的英特尔 ® 网络适配器驱动程序](https://www.intel.cn/content/www/cn/zh/download/838943/intel-network-adapter-driver-for-windows-server-2025.html)
- 打开设备管理器，找到以太网控制器，在其属性页面选择“更新驱动程序”，然后点击“浏览我的计算机以查找驱动程序软件”，然后选择“让我从计算机上的可用驱动程序列表中选取”，接下来在“从以下列表选择设备的类型。”里选择“网络适配器”；然后，在“选择要为此硬件安装的设备驱动程序”界面中，点击右下方的“从磁盘安装”按钮，再点击“浏览”
- 找到驱动文件中的 `e2f.inf`，点击“确定”，然后选择条目“Intel(R) Ethernet Controller I226-LM”即可

### 参考文献

- [华硕主板板载 Intel i225-V 和 i226-V 网卡驱动在 Windows server 2019 下的安装](https://zhuanlan.zhihu.com/p/624820359)。
