# 18.3 树莓派 FreeBSD 配置

## SSH 设置

使用 XShell 登录树莓派，用户名和密码均为 `freebsd`。如需切换到 root 用户，请登录后执行 `su`，并输入 root 用户的密码。


## 调整时区

设置系统时区：

```sh
# tzsetup
```

在设置时依次选择 `No` → `5 Asia` → `9 China` → `1 Beijing Time`，当提示 “Does the abbreviation CST look reasonable?” 时，选择 `Yes`。


## 时间设置

接下来进行时间设置。树莓派 5 及之前的型号没有板载 RTC（实时时钟，Real Time Clock）来保证时间的准确性，因此完全依赖 NTP 服务进行时间校正。如果时间不准确，可能会影响多项服务的正常运行。

在 `/etc/rc.conf` 文件中添加以下配置：

```ini
ntpd_enable="YES"               # 启用 NTP 守护进程
ntpdate_enable="YES"            # 启用系统启动时使用 ntpdate 同步时间
ntpdate_program="ntpdate"       # 指定使用的时间同步程序
ntpdate_flags="0.cn.pool.ntp.org"   # 指定 NTP 服务器地址
```

启动 `ntpdate` 服务以同步系统时间：


```sh
# service ntpdate start
```

查看当前系统日期和时间：

```sh
# date
Tue Aug  1 16:45:55 CST 2023
```

### 主机名

在 `/etc/rc.conf` 文件中，可以修改主机名，例如 `hostname="generic"`，将 `generic` 替换为所需的主机名。


## CPU 频率

CPU 频率调整（600 MHz 到 1500 MHz）：

```sh
# sysrc powerd_enable="YES"     # 设置开机启用 powerd 动态调节 CPU 频率
# service powerd restart        # 重启 powerd 服务以应用配置
```

## 显示温度

列出所有系统内核参数，并筛选包含 temperature（温度）的信息：

```sh
# sysctl -a | grep temperature
hw.cpufreq.temperature: 50598
dev.cpu.0.temperature: 51.0C
```

也可以查看各个 CPU 核心的温度信息：

```sh
# sysctl dev.cpu | grep temperature
dev.cpu.0.temperature: 50.1C
```

## 查看 CPU 频率

显示 CPU 核心 0 的可用频率等级列表：

```sh
# sysctl dev.cpu.0.freq_levels
dev.cpu.0.freq_levels: 2000/-1 600/-1
```

## htop

- 使用 pkg 安装：

```sh
# pkg install htop
```

- 或者使用 Ports 安装：

```sh
# cd /usr/ports/sysutils/htop/ 
# make install clean
```

---

持久化设置（默认情况下，F10 保存后无法使用 `Ctrl + C`，必须选择 `quit` 才能保存设置；也可以通过文件进行指定）。

编辑 `~/.config/htop/htoprc` 文件，写入以下内容以显示 CPU 频率和温度：


```ini
show_cpu_frequency=1     # 启用 CPU 当前频率显示
show_cpu_temperature=1   # 启用 CPU 温度显示
```

## 参考文献

- [Settings are not saved](https://github.com/htop-dev/htop/issues/949)，htop 设置
- [FreeBSD/ARM on the Raspberry Pi family](https://wiki.freebsd.org/arm/Raspberry%20Pi)
- [Raspberry Pi 树莓派中文文档](https://rpicn.bsdcn.org)
